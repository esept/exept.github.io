<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>1</title>
    <url>/2020/05/15/1/</url>
    <content><![CDATA[<p>我想给博客上加上一点自己的东西，比如电影的介绍和推荐，</p>
]]></content>
  </entry>
  <entry>
    <title>Diary-05-2020</title>
    <url>/2020/05/10/diary/</url>
    <content><![CDATA[<p>这里曾经，依旧是我的五月<br>岁月漫长，但是值得等待<br> <a id="more"></a></p>
<h2 id="2020-05"><a href="#2020-05" class="headerlink" title="2020-05"></a>2020-05</h2><p>自己剖析自己是一件挺可怕的事情，因为有的时候一旦发现自己做那件事的原因竟然是因为这样的一个理由，如果这样的原因是一个不愿被自己接受的结果，那面对自己都会有一点不情愿<br>对于爬虫这个东西真的是麻烦，做个项目竟然还要自己购买代理</p>
<p>今天不知道是第几次试图创建图片流失败了<br>我基本上已经要放弃尝试了，现在前端的东西一点也不会，完全就是按照网上的教程来进行自己的操作<br>然后嘞，我发现现在这样子的一个环境还是很适合自己的<br>因为很有感觉<br>然后发现自己创建更新内容和前端，访问量轻轻松松上百</p>
<p>Emmm。。。</p>
<p>想回国的时候去北京吃一堆想吃的东西</p>
<p>今天先这样子吧</p>
<p>喜欢下雨天。</p>
]]></content>
      <categories>
        <category>日记</category>
      </categories>
      <tags>
        <tag>采集忘却</tag>
      </tags>
  </entry>
  <entry>
    <title>他是诗人</title>
    <url>/2020/05/08/doc/</url>
    <content><![CDATA[<p>他曾说 我爱你<br>就像叶爱飘零 风爱游荡<br>他曾禁锢在个人世界<br>无人读懂 欢喜惆怅<br> <a id="more"></a></p>
<p>让岁月抚平忧伤<br>年华换成怅惘<br>星空月夜伴随凄凉<br>独自扼杀希望</p>
<p>谁说诗人习惯独自流浪<br>只不过从未找到过家的方向<br>他在尝试抚平心灵创伤<br>用诗来抒发梦想</p>
<p>他也曾尝过爱情<br>决绝 苦涩 需要勇气<br>他不许任何人亵渎这经历<br>就像他人亵渎自己</p>
<p>他早迷失在混乱世界<br>等待爱人将他救起<br>他却说我是诗人<br>悲伤才是对的记忆</p>
<p>他在等人帮他抹去泪水<br>等人填补空洞心伤<br>诗人强撑着精神病体<br>说着自由 理应继续彷徨</p>
<p>现在的我向往自由与孤独<br>现在的我甘愿流浪<br>诗人不停地大声吟唱<br>天空的雨滴浸透出点点荒凉</p>
<p>诗人的梦里有他想要的一切<br>却不知从何记起<br>他在夜里悲伤的哭泣<br>谁又见过他的无助模样</p>
<p>他还在用低沉的声音吟唱<br>唱出对世界无尽的失望<br>海阔天空和万丈悬崖其实一样<br>都会抛下久违的梦想</p>
<p>诗人披着月光<br>低吟清唱着他的忧伤<br>他说坚强一点<br>就像月光不惧朝阳</p>
<p>他在慢慢游荡<br>渐渐走向陌生的远方<br>他也不想背井离乡<br>只因这里过分凄凉</p>
<p>其实诗人早就死亡<br>只剩他的躯体被迫流浪<br>他的灵魂灰飞烟灭<br>却无人惋惜他的坚强</p>
<p>你是否曾望见过诗人的孤寂背影<br>就像月光才是最柔美的光芒<br>人们不知是否该去祭奠<br>来安抚孤魂的游荡带来的离殇</p>
<p>固执的他 说 我是诗人<br>怎敢以流泪缓解悲伤<br>他说我喜欢孤身一人 只身迎接<br>坎坷路途上的天堂</p>
]]></content>
      <categories>
        <category>思考与遐想</category>
      </categories>
      <tags>
        <tag>采集忘却</tag>
      </tags>
  </entry>
  <entry>
    <title>Jupyter notebook 基础</title>
    <url>/2020/05/15/jupyternotebook/</url>
    <content><![CDATA[<p>数据科学原理与数据处理第一节<br>Jupyter Notebook的基础使用</p>
<a id="more"></a>


<h1 id="Jupyter-环境安装与运行"><a href="#Jupyter-环境安装与运行" class="headerlink" title="Jupyter 环境安装与运行"></a>Jupyter 环境安装与运行</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>pip install jupyter</p>
<h2 id="打开Jupyter"><a href="#打开Jupyter" class="headerlink" title="打开Jupyter"></a>打开Jupyter</h2><p>cd ‘想建立jupyter文件的地址’</p>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>在添加好地址后输入 ‘juputer notebook’ 即可</p>
<h2 id="运行Jupyter里的代码"><a href="#运行Jupyter里的代码" class="headerlink" title="运行Jupyter里的代码"></a>运行Jupyter里的代码</h2><p>在所在代码行点击shift+enter</p>
<h1 id="Jupyter-魔法命令"><a href="#Jupyter-魔法命令" class="headerlink" title="Jupyter 魔法命令"></a>Jupyter 魔法命令</h1><p>魔法命令必须在开头，不能有注释</p>
<h2 id="run-文件名"><a href="#run-文件名" class="headerlink" title="%run ./文件名"></a>%run ./文件名</h2><p>运行文件夹下的文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt; my_test.py</span><br><span class="line">print(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%run ./my_test.py</span><br><span class="line"><span class="comment">#################</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<h2 id="load-加载一个函数"><a href="#load-加载一个函数" class="headerlink" title="%load 加载一个函数"></a>%load 加载一个函数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt; my_test.py</span><br><span class="line">print(<span class="string">'hello world'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_print</span><span class="params">(x)</span>:</span></span><br><span class="line">	print(x)</span><br></pre></td></tr></table></figure>
<p>再重新执行生成语句，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># %load ./my_test.py</span></span><br><span class="line">print(<span class="string">'hello world'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_print</span><span class="params">(x)</span>:</span></span><br><span class="line">	print(x)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">my_print(<span class="number">1</span>)</span><br><span class="line"><span class="comment">###########</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>倒入文件的另一种方式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> my_test <span class="keyword">import</span> my_print</span><br></pre></td></tr></table></figure>
<blockquote>
<p>notebook 只会针对同一文件导入一次，如果在倒入后又重新更改，需要用%run来从新加载一遍，以便达到更新的作用</p>
</blockquote>
<h2 id="timeit-查看代码执行时间"><a href="#timeit-查看代码执行时间" class="headerlink" title="%timeit 查看代码执行时间"></a>%timeit 查看代码执行时间</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列表生成式</span></span><br><span class="line">%timeit li = [i **<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>)]</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">228</span> µs ± <span class="number">4.31</span> µs per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">1000</span> loops each) 运行<span class="number">1000</span>次的平均值</span><br><span class="line"></span><br><span class="line">%timeit li = [i **<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000000</span>)]</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">246</span> ms ± <span class="number">2.91</span> ms per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">1</span> loop each) 一次的值</span><br></pre></td></tr></table></figure>

<p>%timeit 只能测试一行代码，如果想测试代码块，则运用 <b>%%timeit</b></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%%timeit</span><br><span class="line">li = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    li.append(i**<span class="number">2</span>)</span><br><span class="line">&gt; <span class="number">267</span> µs ± <span class="number">4.03</span> µs per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">1000</span> loops each)</span><br><span class="line"><span class="comment"># 在python中，使用列表生成式比for更高效</span></span><br></pre></td></tr></table></figure>
<h2 id="time-测量一次代码执行的时间"><a href="#time-测量一次代码执行的时间" class="headerlink" title="%time  测量一次代码执行的时间"></a>%time  测量一次代码执行的时间</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%time li = [i **<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000000</span>)]</span><br><span class="line"></span><br><span class="line">&gt; CPU times: user <span class="number">238</span> ms, sys: <span class="number">10</span> ms, total: <span class="number">248</span> ms Wall time: <span class="number">247</span> ms</span><br><span class="line"></span><br><span class="line">%%time</span><br><span class="line">li = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    li.append(i**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">&gt; CPU times: user <span class="number">8.62</span> ms, sys: <span class="number">3.61</span> ms, total: <span class="number">12.2</span> ms</span><br><span class="line">Wall time: <span class="number">12.2</span> ms</span><br></pre></td></tr></table></figure>

<h2 id="html"><a href="#html" class="headerlink" title="%%html"></a>%%html</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%%html</span><br><span class="line">&lt;div calss = 'mytest'&gt; html content &lt;/div&gt;</span><br><span class="line"><span class="comment">##</span></span><br><span class="line">&gt; html content</span><br></pre></td></tr></table></figure>

<h2 id="writefile"><a href="#writefile" class="headerlink" title="%%writefile"></a>%%writefile</h2><p>写入文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%%writefile haha.py</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">li = [random.random() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>)]</span><br><span class="line">%timeit li.sort()</span><br></pre></td></tr></table></figure>










]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>数据分析与数据挖掘</tag>
        <tag>Jupyter Notebook</tag>
      </tags>
  </entry>
  <entry>
    <title>Pandas</title>
    <url>/2020/05/17/Pandas/</url>
    <content><![CDATA[<p>pandas的基础应用</p>
<a id="more"></a>

<h1 id="Pandas基础"><a href="#Pandas基础" class="headerlink" title="Pandas基础"></a>Pandas基础</h1><h2 id="Pandas介绍与安装"><a href="#Pandas介绍与安装" class="headerlink" title="Pandas介绍与安装"></a>Pandas介绍与安装</h2><h3 id="安装与引入"><a href="#安装与引入" class="headerlink" title="安装与引入"></a>安装与引入</h3><blockquote>
<p>$ pip install pandas<br>import pandas as pd</p>
</blockquote>
<h3 id="基础定义"><a href="#基础定义" class="headerlink" title="基础定义"></a>基础定义</h3><p>pandas中对数据的选取操作</p>
<ol>
<li>Index</li>
<li>Columns</li>
<li>Ioc</li>
<li>iloc</li>
</ol>
<p>Series：列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列的初始化</span></span><br><span class="line">pd.Series()</span><br><span class="line"><span class="comment">#例子</span></span><br><span class="line">ser = pd.Series([<span class="string">'zhangsan'</span>,<span class="string">'lisi'</span>,<span class="string">'wangwu'</span>])</span><br><span class="line">ser</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">0</span>    zhangsan</span><br><span class="line"><span class="number">1</span>        lisi</span><br><span class="line"><span class="number">2</span>      wangwu</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ser[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="string">'lisi'</span></span><br><span class="line"></span><br><span class="line">ser[<span class="number">2</span>] = <span class="string">'Jack'</span></span><br><span class="line">ser</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    zhangsan</span><br><span class="line"><span class="number">2</span>        Jack</span><br><span class="line"><span class="number">3</span>      wangwu</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">ind = [<span class="number">1</span>,<span class="number">3</span>]</span><br><span class="line">ser[ind]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    zhangsan</span><br><span class="line"><span class="number">3</span>      wangwu</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">ser.values</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">array([<span class="string">'zhangsan'</span>, <span class="string">'Jack'</span>, <span class="string">'wangwu'</span>], dtype=object)</span><br><span class="line"></span><br><span class="line">type(ser.values)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">numpy.ndarray</span><br><span class="line"></span><br><span class="line">ser2 = pd.Series([<span class="number">18</span>,<span class="number">19</span>,<span class="number">17</span>],index = range(<span class="number">1</span>,<span class="number">4</span>))</span><br><span class="line">ser2</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    <span class="number">18</span></span><br><span class="line"><span class="number">2</span>    <span class="number">19</span></span><br><span class="line"><span class="number">3</span>    <span class="number">17</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">ser2+<span class="number">1</span> <span class="comment"># 整体加一</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    <span class="number">19</span></span><br><span class="line"><span class="number">2</span>    <span class="number">20</span></span><br><span class="line"><span class="number">3</span>    <span class="number">18</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">ser2[ser2%<span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    <span class="number">18</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">data=&#123;<span class="string">'beijing'</span>: <span class="number">9240</span>,<span class="string">'shanghai'</span>:<span class="number">8960</span>,<span class="string">'guangzhou'</span>:<span class="number">7400</span>&#125;</span><br><span class="line">ser3 = pd.Series(data)</span><br><span class="line">ser3</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">beijing      <span class="number">9240</span></span><br><span class="line">shanghai     <span class="number">8960</span></span><br><span class="line">guangzhou    <span class="number">7400</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">ser3[<span class="string">'beijing'</span>]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">9240</span></span><br><span class="line"></span><br><span class="line"><span class="string">'beijing'</span> <span class="keyword">in</span> ser3</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ser3 <span class="comment"># 有索引的列对象</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">beijing      <span class="number">9240</span></span><br><span class="line">shanghai     <span class="number">8960</span></span><br><span class="line">guangzhou    <span class="number">7400</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">ser3.to_list()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">[<span class="number">9240</span>, <span class="number">8960</span>, <span class="number">7400</span>]</span><br><span class="line"></span><br><span class="line">ser3.to_dict()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">&#123;<span class="string">'beijing'</span>: <span class="number">9240</span>, <span class="string">'shanghai'</span>: <span class="number">8960</span>, <span class="string">'guangzhou'</span>: <span class="number">7400</span>&#125;</span><br><span class="line"></span><br><span class="line">ser3.tolist()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">[<span class="number">9240</span>, <span class="number">8960</span>, <span class="number">7400</span>]</span><br><span class="line"></span><br><span class="line">ser3.to_json()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="string">'&#123;"beijing":9240,"shanghai":8960,"guangzhou":7400&#125;'</span></span><br><span class="line"></span><br><span class="line">ser3.to_frame() <span class="comment">#表 Dataframe</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">			<span class="number">0</span></span><br><span class="line">beijing 	<span class="number">9240</span></span><br><span class="line">shanghai 	<span class="number">8960</span></span><br><span class="line">guangzhou 	<span class="number">7400</span></span><br></pre></td></tr></table></figure>
<p>DataFrame：表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ser3.to_frame() <span class="comment">#表 Dataframe</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">			<span class="number">0</span></span><br><span class="line">beijing 	<span class="number">9240</span></span><br><span class="line">shanghai 	<span class="number">8960</span></span><br><span class="line">guangzhou 	<span class="number">7400</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.arange(<span class="number">100</span>,<span class="number">109</span>).reshape(<span class="number">3</span>,<span class="number">-1</span>)</span><br><span class="line">data</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">array([[<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>],</span><br><span class="line">       [<span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>],</span><br><span class="line">       [<span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>]])</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="comment"># 索引</span></span><br><span class="line">	<span class="number">0</span> 		<span class="number">1</span> 		<span class="number">2</span>   <span class="comment"># 列名</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">100</span> 	<span class="number">101</span> 	<span class="number">102</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">103</span> 	<span class="number">104</span> 	<span class="number">105</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">106</span> 	<span class="number">107</span> 	<span class="number">108</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:[<span class="string">'jack'</span>,<span class="string">'mary'</span>,<span class="string">'lily'</span>],</span><br><span class="line">    <span class="string">'age'</span>:[<span class="number">19</span>,<span class="number">19</span>,<span class="number">17</span>],</span><br><span class="line">    <span class="string">'height'</span>:[<span class="number">1.68</span>,<span class="number">1.73</span>,<span class="number">1.63</span>]</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	name 	age 	height</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 		<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	mary 	<span class="number">19</span> 		<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	lily 	<span class="number">17</span> 		<span class="number">1.63</span></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data, columns = [<span class="string">'username'</span>,<span class="string">'age'</span>,<span class="string">'height'</span>,<span class="string">'email'</span>],index = range(<span class="number">1</span>,<span class="number">4</span>))</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	username 	age 	height 	email</span><br><span class="line"><span class="number">1</span> 	NaN 		<span class="number">19</span> 		<span class="number">1.68</span> 	NaN</span><br><span class="line"><span class="number">2</span> 	NaN 		<span class="number">19</span> 		<span class="number">1.73</span> 	NaN</span><br><span class="line"><span class="number">3</span> 	NaN 		<span class="number">17</span> 		<span class="number">1.63</span> 	NaN</span><br><span class="line"></span><br><span class="line">df.index</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">RangeIndex(start=<span class="number">0</span>, stop=<span class="number">3</span>, step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data, columns = [<span class="string">'name'</span>,<span class="string">'age'</span>,<span class="string">'height'</span>,<span class="string">'email'</span>],index = range(<span class="number">1</span>,<span class="number">4</span>))</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	name 	age 	height 	email</span><br><span class="line"><span class="number">1</span> 	jack 	<span class="number">19</span> 		<span class="number">1.68</span> 	NaN</span><br><span class="line"><span class="number">2</span> 	mary 	<span class="number">19</span> 		<span class="number">1.73</span> 	NaN</span><br><span class="line"><span class="number">3</span> 	lily 	<span class="number">17</span> 		<span class="number">1.63</span> 	NaN</span><br></pre></td></tr></table></figure>
<h3 id="Pandas中的数据选取操作"><a href="#Pandas中的数据选取操作" class="headerlink" title="Pandas中的数据选取操作"></a>Pandas中的数据选取操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:[<span class="string">'张三'</span>,<span class="string">'李四'</span>,<span class="string">'王五'</span>,<span class="string">'张六'</span>],</span><br><span class="line">    <span class="string">'age'</span>:[<span class="number">19</span>,<span class="number">19</span>,<span class="number">17</span>,<span class="number">20</span>],</span><br><span class="line">    <span class="string">'height'</span>:[<span class="number">1.68</span>,<span class="number">1.73</span>,<span class="number">1.63</span>,<span class="number">1.55</span>]</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data,columns =[<span class="string">'name'</span>,<span class="string">'age'</span>,<span class="string">'height'</span>] )</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height</span><br><span class="line"><span class="number">0</span> 	张三 	<span class="number">19</span> 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'name'</span>]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">0</span>    张三</span><br><span class="line"><span class="number">1</span>    李四</span><br><span class="line"><span class="number">2</span>    王五</span><br><span class="line"><span class="number">3</span>    张六</span><br><span class="line">Name: name, dtype: object</span><br><span class="line"></span><br><span class="line">df.age</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">0</span>    <span class="number">19</span></span><br><span class="line"><span class="number">1</span>    <span class="number">19</span></span><br><span class="line"><span class="number">2</span>    <span class="number">17</span></span><br><span class="line"><span class="number">3</span>    <span class="number">20</span></span><br><span class="line">Name: age, dtype: int64</span><br><span class="line"></span><br><span class="line">df[[<span class="string">'name'</span>]] <span class="comment"># dataframe格式</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name</span><br><span class="line"><span class="number">0</span> 	张三</span><br><span class="line"><span class="number">1</span> 	李四</span><br><span class="line"><span class="number">2</span> 	王五</span><br><span class="line"><span class="number">3</span> 	张六</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df[[<span class="string">'age'</span>,<span class="string">'name'</span>]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	age 	name</span><br><span class="line"><span class="number">0</span> 	<span class="number">19</span> 	张三</span><br><span class="line"><span class="number">1</span> 	<span class="number">19</span> 	李四</span><br><span class="line"><span class="number">2</span> 	<span class="number">17</span> 	王五</span><br><span class="line"><span class="number">3</span> 	<span class="number">20</span> 	张六</span><br><span class="line"></span><br><span class="line">names = df[<span class="string">'name'</span>]</span><br><span class="line">names[<span class="number">0</span>] = <span class="string">'jack'</span> <span class="comment"># 原表里的值也会同时被改变</span></span><br><span class="line"><span class="comment"># -&gt;  对复制的警告！</span></span><br><span class="line">/Users/xuzy/opt/anaconda3/lib/python3<span class="number">.7</span>/site-packages/ipykernel_launcher.py:<span class="number">2</span>: SettingWithCopyWarning: </span><br><span class="line">A value <span class="keyword">is</span> trying to be set on a copy of a slice <span class="keyword">from</span> a DataFrame</span><br><span class="line"></span><br><span class="line">See the caveats <span class="keyword">in</span> the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html<span class="comment">#returning-a-view-versus-a-copy</span></span><br><span class="line">  </span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line">names = df.name.copy()</span><br><span class="line">names</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">0</span>    jack</span><br><span class="line"><span class="number">1</span>      李四</span><br><span class="line"><span class="number">2</span>      王五</span><br><span class="line"><span class="number">3</span>      张六</span><br><span class="line">Name: name, dtype: object</span><br><span class="line"></span><br><span class="line">names[<span class="number">0</span>] = <span class="string">'周八'</span></span><br><span class="line">names</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">0</span>    周八</span><br><span class="line"><span class="number">1</span>    李四</span><br><span class="line"><span class="number">2</span>    王五</span><br><span class="line"><span class="number">3</span>    张六</span><br><span class="line">Name: name, dtype: object</span><br><span class="line"></span><br><span class="line">df.columns</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">Index([<span class="string">'name'</span>, <span class="string">'age'</span>, <span class="string">'height'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df.columns[<span class="number">1</span>:<span class="number">3</span>] <span class="comment"># name-&gt;0;age-&gt;1;height-&gt;2</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">Index([<span class="string">'age'</span>, <span class="string">'height'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df[df.columns[<span class="number">1</span>:<span class="number">3</span>]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	age 	height</span><br><span class="line"><span class="number">0</span> 	<span class="number">19</span> 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">19</span> 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">17</span> 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	<span class="number">20</span> 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	height</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">df[<span class="string">'year'</span>] = datetime.datetime.now().year-df.age <span class="comment"># 做差</span></span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"></span><br><span class="line">df.drop(<span class="string">'year'</span>,axis=<span class="number">1</span>) <span class="comment"># 删除</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	height</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line">df.drop([<span class="string">'year'</span>,<span class="string">'height'</span>],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span></span><br><span class="line"></span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"></span><br><span class="line">df.drop(df.columns[<span class="number">1</span>::<span class="number">2</span>],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	height</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">1.68</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">1.73</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">1.63</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">1.55</span></span><br><span class="line"></span><br><span class="line">df.loc[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">name        李四</span><br><span class="line">age         <span class="number">19</span></span><br><span class="line">height    <span class="number">1.73</span></span><br><span class="line">year      <span class="number">2001</span></span><br><span class="line">Name: <span class="number">1</span>, dtype: object</span><br><span class="line"></span><br><span class="line">df.loc[[<span class="number">1</span>]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"></span><br><span class="line">df.loc[[<span class="number">1</span>,<span class="number">3</span>]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不知道索引值，想要最后两个数据的名字和age</span></span><br><span class="line">df.index</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">RangeIndex(start=<span class="number">0</span>, stop=<span class="number">4</span>, step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">df.index[<span class="number">-2</span>:] <span class="comment"># 答案为start 最小，stop 最后，</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">RangeIndex(start=<span class="number">2</span>, stop=<span class="number">4</span>, step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">df.loc[df.index[<span class="number">-2</span>:]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"></span><br><span class="line">df.loc[df.index[<span class="number">-2</span>:],[<span class="string">'name'</span>,<span class="string">'age'</span>]]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age</span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span></span><br><span class="line"></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在最后一行插入数据</span></span><br><span class="line">df.loc[df.shape[<span class="number">0</span>]] = &#123;<span class="string">'age'</span>:<span class="number">21</span>,<span class="string">'name'</span>:<span class="string">'五九'</span>,<span class="string">'height'</span>:<span class="number">1.66</span>,<span class="string">'year'</span>:<span class="number">0</span>&#125;</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"><span class="number">4</span> 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2 = df.drop(<span class="number">2</span>)</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"><span class="number">4</span> 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2.index = range(df2.shape[<span class="number">0</span>])</span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"><span class="number">3</span> 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2 = df.drop(<span class="number">2</span>)</span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">3</span> 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"><span class="number">4</span> 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df2.loc[<span class="number">2</span>] <span class="comment"># 因为已经删除所以找不到2</span></span><br><span class="line"><span class="comment"># -&gt; 报错</span></span><br><span class="line"></span><br><span class="line">df2.iloc[<span class="number">2</span>] <span class="comment"># 物理索引，顺序为2的-&gt;底层内存中存储的物理顺序</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">name        张六</span><br><span class="line">age         <span class="number">20</span></span><br><span class="line">height    <span class="number">1.55</span></span><br><span class="line">year      <span class="number">2000</span></span><br><span class="line">Name: <span class="number">3</span>, dtype: object</span><br><span class="line"></span><br><span class="line">df2.index = list(<span class="string">'ABCD'</span>) <span class="comment"># 索引改变</span></span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">A 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line">B 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line">C 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line">D 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2.iloc[<span class="number">1</span>:<span class="number">3</span>] <span class="comment"># 第二、三行-&gt; 序号为1和2</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">B 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line">C 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line"></span><br><span class="line">df2.iat[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">19</span></span><br><span class="line"></span><br><span class="line">df2.iat[<span class="number">1</span>,<span class="number">1</span>] = <span class="number">66</span></span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">A 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line">B 	李四 	<span class="number">66</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line">C 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line">D 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2.iat[<span class="number">1</span>,<span class="number">2</span>] = <span class="number">88</span></span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">A 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line">B 	李四 	<span class="number">66</span> 	<span class="number">88.00</span> 	<span class="number">2001</span></span><br><span class="line">C 	张六 	<span class="number">20</span> 	<span class="number">1.55</span> 	<span class="number">2000</span></span><br><span class="line">D 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2[<span class="string">'height'</span>]&gt;=<span class="number">1.65</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">A     <span class="literal">True</span></span><br><span class="line">B     <span class="literal">True</span></span><br><span class="line">C    <span class="literal">False</span></span><br><span class="line">D     <span class="literal">True</span></span><br><span class="line">Name: height, dtype: bool</span><br><span class="line"></span><br><span class="line">df2[df2[<span class="string">'height'</span>]&gt;=<span class="number">1.65</span>] <span class="comment"># 获取条件成立的所有行数据</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">A 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line">B 	李四 	<span class="number">66</span> 	<span class="number">88.00</span> 	<span class="number">2001</span></span><br><span class="line">D 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">df2[(df2[<span class="string">'age'</span>]&lt;=<span class="number">20</span>) &amp; (df2[<span class="string">'height'</span>]&gt;=<span class="number">1.65</span>)]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line">A 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"></span><br><span class="line">df.query(<span class="string">'height&gt;=1.65 and age &lt;= 20'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"></span><br><span class="line">df.query(<span class="string">'height&gt;=1.65 and age &lt;= 20 or name == "五九"'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">4</span> 	五九 	<span class="number">21</span> 	<span class="number">1.66</span> 	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">age1 = <span class="number">20</span> <span class="comment"># 筛选条件</span></span><br><span class="line">df.query(<span class="string">'age&lt;@age1'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'age'</span>].isin([<span class="number">18</span>,<span class="number">19</span>])</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line"><span class="number">0</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">1</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">2</span>    <span class="literal">False</span></span><br><span class="line"><span class="number">3</span>    <span class="literal">False</span></span><br><span class="line"><span class="number">4</span>    <span class="literal">False</span></span><br><span class="line">Name: age, dtype: bool</span><br><span class="line"></span><br><span class="line">df[df[<span class="string">'age'</span>].isin([<span class="number">17</span>,<span class="number">19</span>])]</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age height 	year</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">19</span> 	<span class="number">1.68</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">1</span> 	李四 	<span class="number">19</span> 	<span class="number">1.73</span> 	<span class="number">2001</span></span><br><span class="line"><span class="number">2</span> 	王五 	<span class="number">17</span> 	<span class="number">1.63</span> 	<span class="number">2003</span></span><br><span class="line"></span><br><span class="line">df.T <span class="comment"># 行列对调</span></span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">		<span class="number">0</span> 		<span class="number">1</span> 		<span class="number">2</span> 		<span class="number">3</span> 		<span class="number">4</span></span><br><span class="line">name 	jack 	李四 	王五 	张六 	五九</span><br><span class="line">age 	<span class="number">19</span> 		<span class="number">19</span> 		<span class="number">17</span> 		<span class="number">20</span> 		<span class="number">21</span></span><br><span class="line">height 	<span class="number">1.68</span> 	<span class="number">1.73</span> 	<span class="number">1.63</span> 	<span class="number">1.55</span> 	<span class="number">1.66</span></span><br><span class="line">year 	<span class="number">2001</span> 	<span class="number">2001</span> 	<span class="number">2003</span> 	<span class="number">2000</span> 	<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="Pandas倒入数据"><a href="#Pandas倒入数据" class="headerlink" title="Pandas倒入数据"></a>Pandas倒入数据</h3><p>####倒入txt<br>-&gt; tab 生成列（列分割）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'/Users/xuzy/Downloads/Python_CSDN/第七章：数据科学原理与数据处理/模块四 第一章/09.代码/统计于分析模块Pandas'</span>) <span class="comment"># 物理路径 -&gt; 也可使用</span></span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/01.txt'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	email</span><br><span class="line"><span class="number">0</span> 	jack@example.com</span><br><span class="line"><span class="number">1</span> 	mary@example.com</span><br><span class="line"><span class="number">2</span> 	lily@example.com</span><br><span class="line"><span class="number">3</span> 	tom@example.com</span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/02.txt'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	age 	email</span><br><span class="line"><span class="number">0</span> 	jack 	<span class="number">18</span> 	jack@example.com</span><br><span class="line"><span class="number">1</span> 	mary 	<span class="number">19</span> 	mary@example.com</span><br><span class="line"><span class="number">2</span> 	lily 	<span class="number">17</span> 	lily@example.com</span><br><span class="line"><span class="number">3</span> 	tom 	<span class="number">17</span> 	tom@example.com</span><br><span class="line"><span class="number">4</span> 	joe 	<span class="number">20</span> 	joe@example.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/03.txt'</span>) </span><br><span class="line"><span class="comment"># linux 账户信息 存放在 /etc/passwd 冒号分割 </span></span><br><span class="line"><span class="comment"># -&gt; 未分割数据</span></span><br><span class="line">	root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br><span class="line"><span class="number">0</span> 	daemon:x:<span class="number">1</span>:<span class="number">1</span>:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line"><span class="number">1</span> 	bin:x:<span class="number">2</span>:<span class="number">2</span>:bin:/bin:/usr/sbin/nologin</span><br><span class="line"><span class="number">2</span> 	sys:x:<span class="number">3</span>:<span class="number">3</span>:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="number">3</span> 	sync:x:<span class="number">4</span>:<span class="number">65534</span>:sync:/bin:/bin/sync</span><br><span class="line"><span class="number">4</span> 	games:x:<span class="number">5</span>:<span class="number">60</span>:games:/usr/games:/usr/sbin/nologin</span><br><span class="line"><span class="number">5</span> 	man:x:<span class="number">6</span>:<span class="number">12</span>:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line"><span class="number">6</span> 	lp:x:<span class="number">7</span>:<span class="number">7</span>:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line"><span class="number">7</span> 	mail:x:<span class="number">8</span>:<span class="number">8</span>:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line"><span class="number">8</span> 	news:x:<span class="number">9</span>:<span class="number">9</span>:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line"><span class="number">9</span> 	uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/var/spool/uucp:/usr/sbin/no...</span><br><span class="line"><span class="number">10</span> 	proxy:x:<span class="number">13</span>:<span class="number">13</span>:proxy:/bin:/usr/sbin/nologin</span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/03.txt'</span>,sep = <span class="string">':'</span>) </span><br><span class="line"><span class="comment"># -&gt; 未分割数据 将第一行数据作为表头处理</span></span><br><span class="line">	root 	x 	<span class="number">0</span> 	<span class="number">0.1</span> 	root<span class="number">.1</span> 	/root 	/bin/bash</span><br><span class="line"><span class="number">0</span> 	daemon 	x 	<span class="number">1</span> 	<span class="number">1</span> 	daemon 	/usr/sbin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">1</span> 	bin 	x 	<span class="number">2</span> 	<span class="number">2</span> 	bin 	/bin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">2</span> 	sys 	x 	<span class="number">3</span> 	<span class="number">3</span> 	sys 	/dev 	/usr/sbin/nologin</span><br><span class="line"><span class="number">3</span> 	sync 	x 	<span class="number">4</span> 	<span class="number">65534</span> 	sync 	/bin 	/bin/sync</span><br><span class="line"><span class="number">4</span> 	games 	x 	<span class="number">5</span> 	<span class="number">60</span> 	games 	/usr/games 	/usr/sbin/nologin</span><br><span class="line"><span class="number">5</span> 	man 	x 	<span class="number">6</span> 	<span class="number">12</span> 	man 	/var/cache/man 	/usr/sbin/nologin</span><br><span class="line"><span class="number">6</span> 	lp 	x 	<span class="number">7</span> 	<span class="number">7</span> 	lp 	/var/spool/lpd 	/usr/sbin/nologin</span><br><span class="line"><span class="number">7</span> 	mail 	x 	<span class="number">8</span> 	<span class="number">8</span> 	mail 	/var/mail 	/usr/sbin/nologin</span><br><span class="line"><span class="number">8</span> 	news 	x 	<span class="number">9</span> 	<span class="number">9</span> 	news 	/var/spool/news 	/usr/sbin/nologin</span><br><span class="line"><span class="number">9</span> 	uucp 	x 	<span class="number">10</span> 	<span class="number">10</span> 	uucp 	/var/spool/uucp 	/usr/sbin/nologin</span><br><span class="line"><span class="number">10</span> 	proxy 	x 	<span class="number">13</span> 	<span class="number">13</span> 	proxy 	/bin 	/usr/sbin/nologin</span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/03.txt'</span>,sep = <span class="string">':'</span>,header = <span class="literal">None</span>) </span><br><span class="line"><span class="comment"># -&gt; 列名无意义</span></span><br><span class="line">	<span class="number">0</span> 	<span class="number">1</span> 	<span class="number">2</span> 	<span class="number">3</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">6</span></span><br><span class="line"><span class="number">0</span> 	root 	x 	<span class="number">0</span> 	<span class="number">0</span> 	root 	/root 	/bin/bash</span><br><span class="line"><span class="number">1</span> 	daemon 	x 	<span class="number">1</span> 	<span class="number">1</span> 	daemon 	/usr/sbin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">2</span> 	bin 	x 	<span class="number">2</span> 	<span class="number">2</span> 	bin 	/bin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">3</span> 	sys 	x 	<span class="number">3</span> 	<span class="number">3</span> 	sys 	/dev 	/usr/sbin/nologin</span><br><span class="line"><span class="number">4</span> 	sync 	x 	<span class="number">4</span> 	<span class="number">65534</span> 	sync 	/bin 	/bin/sync</span><br><span class="line"><span class="number">5</span> 	games 	x 	<span class="number">5</span> 	<span class="number">60</span> 	games 	/usr/games 	/usr/sbin/nologin</span><br><span class="line"><span class="number">6</span> 	man 	x 	<span class="number">6</span> 	<span class="number">12</span> 	man 	/var/cache/man 	/usr/sbin/nologin</span><br><span class="line"><span class="number">7</span> 	lp 	x 	<span class="number">7</span> 	<span class="number">7</span> 	lp 	/var/spool/lpd 	/usr/sbin/nologin</span><br><span class="line"><span class="number">8</span> 	mail 	x 	<span class="number">8</span> 	<span class="number">8</span> 	mail 	/var/mail 	/usr/sbin/nologin</span><br><span class="line"><span class="number">9</span> 	news 	x 	<span class="number">9</span> 	<span class="number">9</span> 	news 	/var/spool/news 	/usr/sbin/nologin</span><br><span class="line"><span class="number">10</span> 	uucp 	x 	<span class="number">10</span> 	<span class="number">10</span> 	uucp 	/var/spool/uucp 	/usr/sbin/nologin</span><br><span class="line"><span class="number">11</span> 	proxy 	x 	<span class="number">13</span> 	<span class="number">13</span> 	proxy 	/bin 	/usr/sbin/nologin</span><br><span class="line"></span><br><span class="line">pd.read_table(<span class="string">'./pandas加载数据/03.txt'</span>,sep = <span class="string">':'</span>,header = <span class="literal">None</span>,names = [<span class="string">'name'</span>,<span class="string">'pwd'</span>,<span class="string">'uid'</span>,<span class="string">'gid'</span>,<span class="string">'local'</span>,<span class="string">'home'</span>,<span class="string">'shell'</span>]) </span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	name 	pwd uid gid local 	home 	shell</span><br><span class="line"><span class="number">0</span> 	root 	x 	<span class="number">0</span> 	<span class="number">0</span> 	root 	/root 	/bin/bash</span><br><span class="line"><span class="number">1</span> 	daemon 	x 	<span class="number">1</span> 	<span class="number">1</span> 	daemon 	/usr/sbin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">2</span> 	bin 	x 	<span class="number">2</span> 	<span class="number">2</span> 	bin 	/bin 	/usr/sbin/nologin</span><br><span class="line"><span class="number">3</span> 	sys 	x 	<span class="number">3</span> 	<span class="number">3</span> 	sys 	/dev 	/usr/sbin/nologin</span><br><span class="line"><span class="number">4</span> 	sync 	x 	<span class="number">4</span> 	<span class="number">65534</span> 	sync 	/bin 	/bin/sync</span><br><span class="line"><span class="number">5</span> 	games 	x 	<span class="number">5</span> 	<span class="number">60</span> 	games 	/usr/games 	/usr/sbin/nologin</span><br><span class="line"><span class="number">6</span> 	man 	x 	<span class="number">6</span> 	<span class="number">12</span> 	man 	/var/cache/man 	/usr/sbin/nologin</span><br><span class="line"><span class="number">7</span> 	lp 	x 	<span class="number">7</span> 	<span class="number">7</span> 	lp 	/var/spool/lpd 	/usr/sbin/nologin</span><br><span class="line"><span class="number">8</span> 	mail 	x 	<span class="number">8</span> 	<span class="number">8</span> 	mail 	/var/mail 	/usr/sbin/nologin</span><br><span class="line"><span class="number">9</span> 	news 	x 	<span class="number">9</span> 	<span class="number">9</span> 	news 	/var/spool/news 	/usr/sbin/nologin</span><br><span class="line"><span class="number">10</span> 	uucp 	x 	<span class="number">10</span> 	<span class="number">10</span> 	uucp 	/var/spool/uucp 	/usr/sbin/nologin</span><br><span class="line"><span class="number">11</span> 	proxy 	x 	<span class="number">13</span> 	<span class="number">13</span> 	proxy 	/bin 	/usr/sbin/nologin</span><br></pre></td></tr></table></figure>
<h4 id="CSV格式"><a href="#CSV格式" class="headerlink" title="CSV格式"></a>CSV格式</h4><p>-&gt; 用逗号进行分割<br>数据库导出文件，兼容性好,通用格式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pd.read_csv(<span class="string">'./pandas加载数据/04.csv'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	书名 	单价</span><br><span class="line"><span class="number">0</span> 	我在未来等你 	<span class="number">29.9</span></span><br><span class="line"><span class="number">1</span> 	原则 	<span class="number">63.0</span></span><br><span class="line"><span class="number">2</span> 	半小时漫画世界史 	<span class="number">28.9</span></span><br></pre></td></tr></table></figure>
<h4 id="excel格式"><a href="#excel格式" class="headerlink" title="excel格式"></a>excel格式</h4><p>插件安装<br>pip install xlrd</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pd.read_excel(<span class="string">'./pandas加载数据/05.xlsx'</span>)</span><br><span class="line"><span class="comment"># -&gt; </span></span><br><span class="line">	电影名称 	上映时间</span><br><span class="line"><span class="number">0</span> 	神秘巨星 	<span class="number">2018</span>/<span class="number">1</span>/<span class="number">19</span></span><br><span class="line"><span class="number">1</span> 	移动迷宫<span class="number">3</span> 	<span class="number">2018</span>/<span class="number">1</span>/<span class="number">26</span></span><br><span class="line"><span class="number">2</span> 	阿凡达<span class="number">2</span> 	<span class="number">2018</span>/<span class="number">12</span>/<span class="number">25</span></span><br></pre></td></tr></table></figure>

<h4 id="html格式"><a href="#html格式" class="headerlink" title="html格式"></a>html格式</h4><p>插件安装</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pd.read_html(<span class="string">'./pandas加载数据/06.html'</span>,header = <span class="number">0</span>) </span><br><span class="line"><span class="comment"># 只会读取table文件，根据class属性进行判断</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">[   排名 城市  工资</span><br><span class="line"> <span class="number">0</span>   <span class="number">1</span>  北京  <span class="number">9240</span></span><br><span class="line"> <span class="number">1</span>   <span class="number">2</span>  上海  <span class="number">8962</span></span><br><span class="line"> <span class="number">2</span>   <span class="number">3</span>  深圳  <span class="number">8315</span></span><br><span class="line"> <span class="number">3</span>   <span class="number">4</span>  广州  <span class="number">7409</span></span><br><span class="line"> <span class="number">4</span>   <span class="number">1</span>  杭州  <span class="number">7330</span>,</span><br><span class="line">    aa  bb  cc</span><br><span class="line"> <span class="number">0</span>  <span class="number">11</span>  <span class="number">22</span>  <span class="number">33</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">44</span>  <span class="number">55</span>  <span class="number">66</span>]</span><br><span class="line"></span><br><span class="line">tables = pd.read_html(<span class="string">'./pandas加载数据/06.html'</span>,header = <span class="number">0</span>) <span class="comment"># 利用赋值将不同的表区分开，并用角标查询</span></span><br><span class="line">tables[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	排名 	城市 	工资</span><br><span class="line"><span class="number">0</span> 	<span class="number">1</span> 	北京 	<span class="number">9240</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">2</span> 	上海 	<span class="number">8962</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">3</span> 	深圳 	<span class="number">8315</span></span><br><span class="line"><span class="number">3</span> 	<span class="number">4</span> 	广州 	<span class="number">7409</span></span><br><span class="line"><span class="number">4</span> 	<span class="number">1</span> 	杭州 	<span class="number">7330</span></span><br><span class="line"></span><br><span class="line">tables[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	aa 	bb 	cc</span><br><span class="line"><span class="number">0</span> 	<span class="number">11</span> 	<span class="number">22</span> 	<span class="number">33</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">44</span> 	<span class="number">55</span> 	<span class="number">66</span></span><br><span class="line"></span><br><span class="line">tables = pd.read_html(<span class="string">'./pandas加载数据/06.html'</span>,header = <span class="number">0</span>,attrs = &#123;<span class="string">'class'</span>:<span class="string">'mydata'</span>&#125;) </span><br><span class="line"><span class="comment"># 利用html里的标签进行表格的区分</span></span><br><span class="line">tables</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">[   排名  城市    工资</span><br><span class="line"> <span class="number">0</span>   <span class="number">1</span>  北京  <span class="number">9240</span></span><br><span class="line"> <span class="number">1</span>   <span class="number">2</span>  上海  <span class="number">8962</span></span><br><span class="line"> <span class="number">2</span>   <span class="number">3</span>  深圳  <span class="number">8315</span></span><br><span class="line"> <span class="number">3</span>   <span class="number">4</span>  广州  <span class="number">7409</span></span><br><span class="line"> <span class="number">4</span>   <span class="number">1</span>  杭州  <span class="number">7330</span>]</span><br><span class="line"></span><br><span class="line">len(tables)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="mysql格式"><a href="#mysql格式" class="headerlink" title="mysql格式"></a>mysql格式</h4><p>安装插件<br>pip install pymysql<br>引入<br> 在将外部数据库导入本地之后，运行下列代码可以将数据导入pandas中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">con = pymysql.connect(host = <span class="string">'localhost'</span>,user = <span class="string">'root'</span>,password=<span class="string">'126511'</span>,database=<span class="string">'doubandb'</span>,charset=<span class="string">'utf8'</span>,use_unicode=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># sql命令</span></span><br><span class="line">sql_cmd = <span class="string">'select * from books'</span></span><br><span class="line">df = pd.read_sql(sql_cmd,con)</span><br><span class="line">df.head(<span class="number">2</span>) <span class="comment"># 显示前两行数据</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>错误提示</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">con = pymysql.connect(host = <span class="string">'localhost'</span>,user = <span class="string">'root'</span>,password=<span class="string">'126511'</span>,database=<span class="string">'douban'</span>,charset=<span class="string">'utf8'</span>,use_unicode=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># sql命令</span></span><br><span class="line">sql_cmd = <span class="string">'select * from books'</span></span><br><span class="line">df = pd.read_sql(sql_cmd,con)</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">InternalError                             Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-32</span>-b8bf00b18871&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">      <span class="number">1</span> <span class="keyword">import</span> pymysql</span><br><span class="line">----&gt; 2 con = pymysql.connect(host = 'localhost',user = 'root',password='126511',database='douban',charset='utf8',use_unicode=True)</span><br><span class="line">      <span class="number">3</span> <span class="comment"># sql命令</span></span><br><span class="line">      <span class="number">4</span> sql_cmd = <span class="string">'select * from books'</span></span><br><span class="line">      <span class="number">5</span> </span><br><span class="line"></span><br><span class="line">~/opt/anaconda3/lib/python3<span class="number">.7</span>/site-packages/pymysql/__init__.py <span class="keyword">in</span> Connect(*args, **kwargs)</span><br><span class="line">     <span class="number">92</span>     <span class="string">"""</span></span><br><span class="line"><span class="string">     93     from .connections import Connection</span></span><br><span class="line"><span class="string">---&gt; 94     return Connection(*args, **kwargs)</span></span><br><span class="line"><span class="string">     95 </span></span><br><span class="line"><span class="string">     96 from . import connections as _orig_conn</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/connections.py in __init__(self, host, user, password, database, port, unix_socket, charset, sql_mode, read_default_file, conv, use_unicode, client_flag, cursorclass, init_command, connect_timeout, ssl, read_default_group, compress, named_pipe, autocommit, db, passwd, local_infile, max_allowed_packet, defer_connect, auth_plugin_map, read_timeout, write_timeout, bind_address, binary_prefix, program_name, server_public_key)</span></span><br><span class="line"><span class="string">    323             self._sock = None</span></span><br><span class="line"><span class="string">    324         else:</span></span><br><span class="line"><span class="string">--&gt; 325             self.connect()</span></span><br><span class="line"><span class="string">    326 </span></span><br><span class="line"><span class="string">    327     def _create_ssl_ctx(self, sslp):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/connections.py in connect(self, sock)</span></span><br><span class="line"><span class="string">    597 </span></span><br><span class="line"><span class="string">    598             self._get_server_information()</span></span><br><span class="line"><span class="string">--&gt; 599             self._request_authentication()</span></span><br><span class="line"><span class="string">    600 </span></span><br><span class="line"><span class="string">    601             if self.sql_mode is not None:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/connections.py in _request_authentication(self)</span></span><br><span class="line"><span class="string">    859 </span></span><br><span class="line"><span class="string">    860         self.write_packet(data)</span></span><br><span class="line"><span class="string">--&gt; 861         auth_packet = self._read_packet()</span></span><br><span class="line"><span class="string">    862 </span></span><br><span class="line"><span class="string">    863         # if authentication method isn't accepted the first byte</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/connections.py in _read_packet(self, packet_type)</span></span><br><span class="line"><span class="string">    682 </span></span><br><span class="line"><span class="string">    683         packet = packet_type(buff, self.encoding)</span></span><br><span class="line"><span class="string">--&gt; 684         packet.check_error()</span></span><br><span class="line"><span class="string">    685         return packet</span></span><br><span class="line"><span class="string">    686 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/protocol.py in check_error(self)</span></span><br><span class="line"><span class="string">    218             errno = self.read_uint16()</span></span><br><span class="line"><span class="string">    219             if DEBUG: print("errno =", errno)</span></span><br><span class="line"><span class="string">--&gt; 220             err.raise_mysql_exception(self._data)</span></span><br><span class="line"><span class="string">    221 </span></span><br><span class="line"><span class="string">    222     def dump(self):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/opt/anaconda3/lib/python3.7/site-packages/pymysql/err.py in raise_mysql_exception(data)</span></span><br><span class="line"><span class="string">    107         errval = data[3:].decode('utf-8', 'replace')</span></span><br><span class="line"><span class="string">    108     errorclass = error_map.get(errno, InternalError)</span></span><br><span class="line"><span class="string">--&gt; 109     raise errorclass(errno, errval)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">InternalError: (1049, "Unknown database 'douban'")</span></span><br></pre></td></tr></table></figure>

<p>出现这个错误的原因是外部数据库没有导入到本地数据库，因此将外部数据导入即可</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -p &lt; 'name'.sql</span><br></pre></td></tr></table></figure>


<h4 id="sort-gt-排序"><a href="#sort-gt-排序" class="headerlink" title="sort -&gt; 排序"></a>sort -&gt; 排序</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">st = pd.Series(list(<span class="string">'CAD'</span>),index = [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">st</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">3</span>    C</span><br><span class="line"><span class="number">1</span>    A</span><br><span class="line"><span class="number">2</span>    D</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">st.sort_index() <span class="comment">#根据索引排序</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    A</span><br><span class="line"><span class="number">2</span>    D</span><br><span class="line"><span class="number">3</span>    C</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">st.sort_values()  <span class="comment"># 根据数据的大小</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">1</span>    A</span><br><span class="line"><span class="number">3</span>    C</span><br><span class="line"><span class="number">2</span>    D</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">st.sort_index(ascending = <span class="literal">False</span>) <span class="comment"># ascending = False反向排序</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">3</span>    C</span><br><span class="line"><span class="number">2</span>    D</span><br><span class="line"><span class="number">1</span>    A</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">arr = [[<span class="number">9</span>,<span class="number">4</span>,<span class="number">8</span>],</span><br><span class="line">       [<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>],</span><br><span class="line">       [<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>]]</span><br><span class="line">df = pd.DataFrame(arr,index=[<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>],columns = list(<span class="string">'cab'</span>))</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 	a 	b</span><br><span class="line"><span class="number">0</span> 	<span class="number">9</span> 	<span class="number">4</span> 	<span class="number">8</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">4</span> 	<span class="number">6</span> 	<span class="number">5</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">3</span></span><br><span class="line"></span><br><span class="line">df.sort_index(ascending = <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 	a 	b</span><br><span class="line"><span class="number">2</span> 	<span class="number">4</span> 	<span class="number">6</span> 	<span class="number">5</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">3</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">9</span> 	<span class="number">4</span> 	<span class="number">8</span></span><br><span class="line"></span><br><span class="line">df.sort_index(axis =<span class="number">1</span>)<span class="comment"># 列排序</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	a 	b 	c</span><br><span class="line"><span class="number">0</span> 	<span class="number">4</span> 	<span class="number">8</span> 	<span class="number">9</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">6</span> 	<span class="number">5</span> 	<span class="number">4</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">5</span> 	<span class="number">3</span> 	<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 对DataFrame某一series排序</span></span><br><span class="line">df.sort_values(by=<span class="string">'c'</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 	a 	b</span><br><span class="line"><span class="number">2</span> 	<span class="number">4</span> 	<span class="number">6</span> 	<span class="number">5</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">3</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">9</span> 	<span class="number">4</span> 	<span class="number">8</span></span><br><span class="line"></span><br><span class="line">df.sort_values(by=<span class="string">'c'</span>,ascending = <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 	a 	b</span><br><span class="line"><span class="number">0</span> 	<span class="number">9</span> 	<span class="number">4</span> 	<span class="number">8</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">4</span> 	<span class="number">6</span> 	<span class="number">5</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">3</span></span><br><span class="line"></span><br><span class="line">df.sort_values(by=[<span class="string">'c'</span>,<span class="string">'a'</span>]) <span class="comment"># 先根据c，后根据a</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 	a 	b</span><br><span class="line"><span class="number">1</span> 	<span class="number">4</span> 	<span class="number">5</span> 	<span class="number">3</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">4</span> 	<span class="number">6</span> 	<span class="number">5</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">9</span> 	<span class="number">4</span> 	<span class="number">8</span></span><br></pre></td></tr></table></figure>

<h4 id="Rank-排名"><a href="#Rank-排名" class="headerlink" title="Rank 排名"></a>Rank 排名</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment">## rank</span></span><br><span class="line"></span><br><span class="line">df.rank() <span class="comment"># 对数据的排名</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 		a 		b</span><br><span class="line"><span class="number">0</span> 	<span class="number">3.0</span> 	<span class="number">1.0</span> 	<span class="number">3.0</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">1.5</span> 	<span class="number">3.0</span> 	<span class="number">2.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">1.5</span> 	<span class="number">2.0</span> 	<span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">df.rank(method = <span class="string">'first'</span>) <span class="comment"># 对数据的排名</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 		a 		b</span><br><span class="line"><span class="number">0</span> 	<span class="number">3.0</span> 	<span class="number">1.0</span> 	<span class="number">3.0</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">1.0</span> 	<span class="number">3.0</span> 	<span class="number">2.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">2.0</span> 	<span class="number">2.0</span> 	<span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">df.rank(method = <span class="string">'max'</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	c 		a 		b</span><br><span class="line"><span class="number">0</span> 	<span class="number">3.0</span> 	<span class="number">1.0</span> 	<span class="number">3.0</span></span><br><span class="line"><span class="number">2</span> 	<span class="number">2.0</span> 	<span class="number">3.0</span> 	<span class="number">2.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">2.0</span> 	<span class="number">2.0</span> 	<span class="number">1.0</span></span><br></pre></td></tr></table></figure>

<h4 id="merge-合并"><a href="#merge-合并" class="headerlink" title="merge 合并"></a>merge 合并</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">'stu_no'</span>:[<span class="string">'s1'</span>,<span class="string">'s2'</span>,<span class="string">'s1'</span>,<span class="string">'s3'</span>,<span class="string">'s1'</span>,<span class="string">'s1'</span>,<span class="string">'s2'</span>,<span class="string">'s4'</span>],</span><br><span class="line">                    <span class="string">'score'</span>:np.random.randint(<span class="number">50</span>,<span class="number">100</span>,size=<span class="number">8</span>)</span><br><span class="line">&#125;)</span><br><span class="line">df1</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	score</span><br><span class="line"><span class="number">0</span> 	s1 		<span class="number">80</span></span><br><span class="line"><span class="number">1</span> 	s2 		<span class="number">93</span>	</span><br><span class="line"><span class="number">2</span> 	s1 		<span class="number">79</span></span><br><span class="line"><span class="number">3</span> 	s3 		<span class="number">82</span></span><br><span class="line"><span class="number">4</span> 	s1 		<span class="number">58</span></span><br><span class="line"><span class="number">5</span> 	s1 		<span class="number">69</span></span><br><span class="line"><span class="number">6</span> 	s2 		<span class="number">60</span></span><br><span class="line"><span class="number">7</span> 	s4 		<span class="number">82</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">'stu_no'</span>:[<span class="string">'s1'</span>,<span class="string">'s2'</span>,<span class="string">'s3'</span>,<span class="string">'s5'</span>],</span><br><span class="line">                    <span class="string">'name'</span>:[<span class="string">' 张三'</span>,<span class="string">'李四'</span>,<span class="string">'王武'</span>,<span class="string">'赵六'</span>]</span><br><span class="line">&#125;)</span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	name</span><br><span class="line"><span class="number">0</span> 	s1 		张三</span><br><span class="line"><span class="number">1</span> 	s2 		李四</span><br><span class="line"><span class="number">2</span> 	s3 		王武</span><br><span class="line"><span class="number">3</span> 	s5 		赵六</span><br><span class="line"></span><br><span class="line">pd.merge(df1,df2,on=<span class="string">'stu_no'</span>) <span class="comment">#属于inner_join连接方式</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	score 	name</span><br><span class="line"><span class="number">0</span> 	s1	 	<span class="number">80</span> 		张三</span><br><span class="line"><span class="number">1</span> 	s1 		<span class="number">79</span> 		张三</span><br><span class="line"><span class="number">2</span> 	s1 		<span class="number">58</span> 		张三</span><br><span class="line"><span class="number">3</span> 	s1 		<span class="number">69</span> 		张三</span><br><span class="line"><span class="number">4</span> 	s2 		<span class="number">93</span> 		李四</span><br><span class="line"><span class="number">5</span> 	s2 		<span class="number">60</span> 		李四</span><br><span class="line"><span class="number">6</span> 	s3 		<span class="number">82</span> 		王武</span><br><span class="line"></span><br><span class="line">pd.merge(df1,df2,on=<span class="string">'stu_no'</span>,how = <span class="string">'left'</span>) <span class="comment">#左连接，A以左边的数据为主，如果右边没有数据显示为空</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	score 	name</span><br><span class="line"><span class="number">0</span> 	s1 		<span class="number">80</span> 		张三</span><br><span class="line"><span class="number">1</span> 	s2 		<span class="number">93</span> 		李四</span><br><span class="line"><span class="number">2</span> 	s1 		<span class="number">79</span> 		张三</span><br><span class="line"><span class="number">3</span> 	s3 		<span class="number">82</span> 		王武</span><br><span class="line"><span class="number">4</span> 	s1 		<span class="number">58</span> 		张三</span><br><span class="line"><span class="number">5</span> 	s1 		<span class="number">69</span> 		张三</span><br><span class="line"><span class="number">6</span> 	s2 		<span class="number">60</span> 		李四</span><br><span class="line"><span class="number">7</span> 	s4 		<span class="number">82</span> 		NaN</span><br><span class="line"></span><br><span class="line">pd.merge(df1,df2,on=<span class="string">'stu_no'</span>,how = <span class="string">'right'</span>) <span class="comment"># 右连接</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	score 	name</span><br><span class="line"><span class="number">0</span> 	s1 		<span class="number">80.0</span> 	张三</span><br><span class="line"><span class="number">1</span> 	s1 		<span class="number">79.0</span> 	张三</span><br><span class="line"><span class="number">2</span> 	s1 		<span class="number">58.0</span> 	张三</span><br><span class="line"><span class="number">3</span> 	s1 		<span class="number">69.0</span> 	张三</span><br><span class="line"><span class="number">4</span> 	s2 		<span class="number">93.0</span> 	李四</span><br><span class="line"><span class="number">5</span> 	s2 		<span class="number">60.0</span> 	李四</span><br><span class="line"><span class="number">6</span> 	s3 		<span class="number">82.0</span> 	王武</span><br><span class="line"><span class="number">7</span> 	s5 		NaN 	赵六</span><br><span class="line"></span><br><span class="line">pd.merge(df1,df2,on=<span class="string">'stu_no'</span>,how = <span class="string">'outer'</span>) <span class="comment"># 外连接</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	stu_no 	score 	name</span><br><span class="line"><span class="number">0</span> 	s1 		<span class="number">80.0</span> 	张三</span><br><span class="line"><span class="number">1</span> 	s1 		<span class="number">79.0</span> 	张三</span><br><span class="line"><span class="number">2</span> 	s1 		<span class="number">58.0</span> 	张三</span><br><span class="line"><span class="number">3</span> 	s1 		<span class="number">69.0</span> 	张三</span><br><span class="line"><span class="number">4</span> 	s2 		<span class="number">93.0</span> 	李四</span><br><span class="line"><span class="number">5</span> 	s2 		<span class="number">60.0</span> 	李四</span><br><span class="line"><span class="number">6</span> 	s3 		<span class="number">82.0</span> 	王武</span><br><span class="line"><span class="number">7</span> 	s4 		<span class="number">82.0</span> 	NaN</span><br><span class="line"><span class="number">8</span> 	s5 		NaN 	赵六</span><br></pre></td></tr></table></figure>

<h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># concat</span></span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">1</span>,<span class="number">5</span>).reshape(<span class="number">2</span>,<span class="number">-1</span>))</span><br><span class="line">df1</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	<span class="number">0</span> 	<span class="number">1</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">1</span> 	<span class="number">2</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">3</span> 	<span class="number">4</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.zeros((<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">df2</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	<span class="number">0</span> 	<span class="number">1</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">pd.concat([df1,df2]) <span class="comment"># 纵向</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	<span class="number">0</span> 	<span class="number">1</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">1.0</span> 	<span class="number">2.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">3.0</span> 	<span class="number">4.0</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">pd.concat([df1,df2],axis=<span class="number">1</span>) <span class="comment"># 横向</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	<span class="number">0</span> 	<span class="number">1</span> 	<span class="number">0</span> 	<span class="number">1</span></span><br><span class="line"><span class="number">0</span> 	<span class="number">1</span> 	<span class="number">2</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"><span class="number">1</span> 	<span class="number">3</span> 	<span class="number">4</span> 	<span class="number">0.0</span> 	<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 异常值的分析</span></span><br><span class="line"></span><br><span class="line">data = [[<span class="number">1</span>,<span class="literal">None</span>],</span><br><span class="line">        [<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">        [<span class="literal">None</span>,<span class="literal">None</span>],</span><br><span class="line">        [<span class="number">8</span>,<span class="number">9</span>],</span><br><span class="line">        [<span class="number">3</span>,<span class="number">4</span>]]</span><br><span class="line">df = pd.DataFrame(data,columns=[<span class="string">'a'</span>,<span class="string">'b'</span>])</span><br><span class="line">df</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	a 		b</span><br><span class="line"><span class="number">0</span> 	<span class="number">1.0</span> 	NaN</span><br><span class="line"><span class="number">1</span> 	<span class="number">4.0</span> 	<span class="number">5.0</span></span><br><span class="line"><span class="number">2</span> 	NaN 	NaN</span><br><span class="line"><span class="number">3</span> 	<span class="number">8.0</span> 	<span class="number">9.0</span></span><br><span class="line"><span class="number">4</span> 	<span class="number">3.0</span> 	<span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">df.head(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	a 		b</span><br><span class="line"><span class="number">0</span> 	<span class="number">1.0</span> 	NaN</span><br><span class="line"><span class="number">1</span> 	<span class="number">4.0</span> 	<span class="number">5.0</span></span><br><span class="line"></span><br><span class="line">df.tail(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">	a 	b</span><br><span class="line"><span class="number">3</span> 	<span class="number">8.0</span> 	<span class="number">9.0</span></span><br><span class="line"><span class="number">4</span> 	<span class="number">3.0</span> 	<span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">df.info()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">pandas</span>.<span class="title">core</span>.<span class="title">frame</span>.<span class="title">DataFrame</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">RangeIndex</span>:</span> <span class="number">5</span> entries, <span class="number">0</span> to <span class="number">4</span></span><br><span class="line">Data columns (total <span class="number">2</span> columns):</span><br><span class="line"> <span class="comment">#   Column  Non-Null Count  Dtype  </span></span><br><span class="line">---  ------  --------------  -----  </span><br><span class="line"> <span class="number">0</span>   a       <span class="number">4</span> non-null      float64</span><br><span class="line"> <span class="number">1</span>   b       <span class="number">3</span> non-null      float64</span><br><span class="line">dtypes: float64(<span class="number">2</span>)</span><br><span class="line">memory usage: <span class="number">208.0</span> bytes</span><br><span class="line"></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">		a 			b</span><br><span class="line">count 	<span class="number">4.00000</span> 	<span class="number">3.000000</span></span><br><span class="line">mean 	<span class="number">4.00000</span> 	<span class="number">6.000000</span></span><br><span class="line">std 	<span class="number">2.94392</span> 	<span class="number">2.645751</span></span><br><span class="line">min 	<span class="number">1.00000</span> 	<span class="number">4.000000</span></span><br><span class="line"><span class="number">25</span>% 	<span class="number">2.50000</span> 	<span class="number">4.500000</span></span><br><span class="line"><span class="number">50</span>% 	<span class="number">3.50000</span> 	<span class="number">5.000000</span></span><br><span class="line"><span class="number">75</span>% 	<span class="number">5.00000</span> 	<span class="number">7.000000</span></span><br><span class="line">max 	<span class="number">8.00000</span> 	<span class="number">9.000000</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> count：一列的元素个数；<br>    mean：一列数据的平均值；<br>    std：一列数据的均方差；（方差的算术平方根，反映一个数据集的离散程度：越大，数据间的差异越大，数据集中数据的离散程度越高；越小，数据间的大小差异越小，数据集中的数据离散程度越低）<br>    min：一列数据中的最小值；<br>    max：一列数中的最大值；<br>    25%：一列数据中，前 25% 的数据的平均值；<br>    50%：一列数据中，前 50% 的数据的平均值；<br>    75%：一列数据中，前 75% 的数据的平均值；</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df.count() <span class="comment"># 数据个数</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">a    <span class="number">4</span></span><br><span class="line">b    <span class="number">3</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">df.mean() </span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">a    <span class="number">4.0</span></span><br><span class="line">b    <span class="number">6.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">df.sum()</span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">a    <span class="number">16.0</span></span><br><span class="line">b    <span class="number">18.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">df.sum(axis = <span class="number">1</span>) <span class="comment">#横向求和</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">0</span>     <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>     <span class="number">9.0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">0.0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">17.0</span></span><br><span class="line"><span class="number">4</span>     <span class="number">7.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">df.a <span class="comment"># </span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">0</span>    <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">4.0</span></span><br><span class="line"><span class="number">2</span>    NaN</span><br><span class="line"><span class="number">3</span>    <span class="number">8.0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">3.0</span></span><br><span class="line">Name: a, dtype: float64</span><br><span class="line"></span><br><span class="line">df.a.sum() <span class="comment"># 对某一列求和</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line"><span class="number">16.0</span></span><br><span class="line"></span><br><span class="line">df.var() <span class="comment"># 方差 -&gt; 开根号-&gt; 标准差</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">a    <span class="number">8.666667</span></span><br><span class="line">b    <span class="number">7.000000</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">df.std() <span class="comment"># 标准差</span></span><br><span class="line"><span class="comment"># -&gt;</span></span><br><span class="line">a    <span class="number">2.943920</span></span><br><span class="line">b    <span class="number">2.645751</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h3 id="pandas合并排序与时间序列"><a href="#pandas合并排序与时间序列" class="headerlink" title="pandas合并排序与时间序列"></a>pandas合并排序与时间序列</h3>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>数据分析与数据挖掘</tag>
        <tag>Jupyter Notebook</tag>
        <tag>numpy</tag>
        <tag>Pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>numpy</title>
    <url>/2020/05/17/numpy/</url>
    <content><![CDATA[<p>numpy的安装及基础操作<br>针对数组和矩阵</p>
<a id="more"></a>
<h1 id="安装与倒入"><a href="#安装与倒入" class="headerlink" title="安装与倒入"></a>安装与倒入</h1><p>pip install numpy<br>import numpy as np</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>numpy是一种数组，本质是ndarray</p>
<h2 id="Python-list"><a href="#Python-list" class="headerlink" title="Python list"></a>Python list</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = list(range(<span class="number">10</span>))</span><br><span class="line">li</span><br><span class="line"></span><br><span class="line">&gt; [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">li[<span class="number">5</span>] = <span class="string">'hello python'</span></span><br><span class="line">li</span><br><span class="line">&gt; [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">'hello python'</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>
<p>list 的类型是不确定的，也可以将其中的一个元素修改成字符串<br>list很灵活，但因为可以存储各种数据，因此很不灵活，在处理大型数据时效率很低</p>
<h2 id="Python-array"><a href="#Python-array" class="headerlink" title="Python array"></a>Python array</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line">arr = array.array(<span class="string">'i'</span>,list(range(<span class="number">10</span>))) <span class="comment"># ‘i'-&gt;类型为正数</span></span><br><span class="line">arr</span><br></pre></td></tr></table></figure>
<p>在修改其中数据的时候，如果将其中的数据修改类型则会出现报错</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr[<span class="number">5</span>] = <span class="string">'hello python'</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError     Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-8</span>-b1067373fade&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; 1 arr[5] = 'hello python'</span><br><span class="line"></span><br><span class="line">TypeError: an integer <span class="keyword">is</span> required (got type str)</span><br></pre></td></tr></table></figure>
<p>如果列表示多维的，那么他们之间的计算就会不方便</p>
<h2 id="numpy-ndarray"><a href="#numpy-ndarray" class="headerlink" title="numpy.ndarray"></a>numpy.ndarray</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nparr = np.array(list(range(<span class="number">10</span>)))</span><br><span class="line">nparr</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">type(nparr)</span><br><span class="line"></span><br><span class="line">&gt; numpy.ndarray</span><br><span class="line"></span><br><span class="line">nparr.dtype <span class="comment">#每个元素的类型</span></span><br><span class="line"></span><br><span class="line">&gt; dtype(<span class="string">'int64'</span>)</span><br><span class="line"></span><br><span class="line">nparr[<span class="number">3</span>] = <span class="number">33</span> <span class="comment"># 修改</span></span><br><span class="line">nparr</span><br><span class="line"></span><br><span class="line">&gt; array([ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">33</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">nparr[<span class="number">3</span>] <span class="comment"># 访问</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="number">33</span></span><br><span class="line"></span><br><span class="line">nparr[<span class="number">3</span>] = <span class="string">'hello python'</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">ValueError            Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-16</span><span class="number">-27473</span>c2d595f&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; 1 nparr[3] = 'hello python'</span><br><span class="line">ValueError: invalid literal <span class="keyword">for</span> int() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">'hello python'</span></span><br><span class="line"></span><br><span class="line">nparr[<span class="number">5</span>] = <span class="number">55.23</span> <span class="comment">#整数类型的ndarray，会忽略小数</span></span><br><span class="line">nparr <span class="comment"># 去掉小数</span></span><br><span class="line"></span><br><span class="line">&gt; array([ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">33</span>,  <span class="number">4</span>, <span class="number">55</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">nparray2 = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3.0</span>])</span><br><span class="line">nparray2.dtype</span><br><span class="line"></span><br><span class="line">&gt; dtype(<span class="string">'float64'</span>)</span><br><span class="line"></span><br><span class="line">nparr3 = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],dtype = float) <span class="comment"># 定义类型</span></span><br><span class="line">nparr3</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>])</span><br></pre></td></tr></table></figure>
<ol>
<li>方便处理多维度数组或者矩阵之间的运算</li>
<li>在处理多维数组或者矩阵，运算效率高<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">python_test</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = [i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    b = [i**<span class="number">3</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c.append(a[i]+b[i])</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">python_test(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"> &gt; [<span class="number">0</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">36</span>, <span class="number">80</span>, <span class="number">150</span>, <span class="number">252</span>, <span class="number">392</span>, <span class="number">576</span>, <span class="number">810</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numpy_test</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = np.arange(n) ** <span class="number">2</span></span><br><span class="line">    b = np.arange(n) ** <span class="number">3</span></span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">numpy_test(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([  <span class="number">0</span>,   <span class="number">2</span>,  <span class="number">12</span>,  <span class="number">36</span>,  <span class="number">80</span>, <span class="number">150</span>, <span class="number">252</span>, <span class="number">392</span>, <span class="number">576</span>, <span class="number">810</span>])</span><br><span class="line"></span><br><span class="line">time res = python_test(<span class="number">100000000</span>)</span><br><span class="line"></span><br><span class="line">&gt; CPU times: user <span class="number">1</span>min <span class="number">4</span>s, sys: <span class="number">15.5</span> s, total: <span class="number">1</span>min <span class="number">20</span>s</span><br><span class="line">Wall time: <span class="number">1</span>min <span class="number">22</span>s</span><br><span class="line"></span><br><span class="line">%time res = numpy_test(<span class="number">100000000</span>)</span><br><span class="line"></span><br><span class="line">&gt; CPU times: user <span class="number">2.37</span> s, sys: <span class="number">4.3</span> s, total: <span class="number">6.67</span> s</span><br><span class="line">Wall time: <span class="number">6.67</span> s</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="矩阵与随机数的生成"><a href="#矩阵与随机数的生成" class="headerlink" title="矩阵与随机数的生成"></a>矩阵与随机数的生成</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">np.array(range(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">np.arange(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">np.arange(<span class="number">2</span>,<span class="number">20</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([ <span class="number">2</span>,  <span class="number">5</span>,  <span class="number">8</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">17</span>])</span><br><span class="line"></span><br><span class="line">np.arange(<span class="number">2</span>,<span class="number">20</span>,<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">&gt; Sarray([ <span class="number">2.</span> ,  <span class="number">2.3</span>,  <span class="number">2.6</span>,  <span class="number">2.9</span>,  <span class="number">3.2</span>,  <span class="number">3.5</span>,  <span class="number">3.8</span>,  <span class="number">4.1</span>,  <span class="number">4.4</span>,  <span class="number">4.7</span>,  <span class="number">5.</span> ,</span><br><span class="line">        <span class="number">5.3</span>,  <span class="number">5.6</span>,  <span class="number">5.9</span>,  <span class="number">6.2</span>,  <span class="number">6.5</span>,  <span class="number">6.8</span>,  <span class="number">7.1</span>,  <span class="number">7.4</span>,  <span class="number">7.7</span>,  <span class="number">8.</span> ,  <span class="number">8.3</span>,</span><br><span class="line">        <span class="number">8.6</span>,  <span class="number">8.9</span>,  <span class="number">9.2</span>,  <span class="number">9.5</span>,  <span class="number">9.8</span>, <span class="number">10.1</span>, <span class="number">10.4</span>, <span class="number">10.7</span>, <span class="number">11.</span> , <span class="number">11.3</span>, <span class="number">11.6</span>,</span><br><span class="line">       <span class="number">11.9</span>, <span class="number">12.2</span>, <span class="number">12.5</span>, <span class="number">12.8</span>, <span class="number">13.1</span>, <span class="number">13.4</span>, <span class="number">13.7</span>, <span class="number">14.</span> , <span class="number">14.3</span>, <span class="number">14.6</span>, <span class="number">14.9</span>,</span><br><span class="line">       <span class="number">15.2</span>, <span class="number">15.5</span>, <span class="number">15.8</span>, <span class="number">16.1</span>, <span class="number">16.4</span>, <span class="number">16.7</span>, <span class="number">17.</span> , <span class="number">17.3</span>, <span class="number">17.6</span>, <span class="number">17.9</span>, <span class="number">18.2</span>,</span><br><span class="line">       <span class="number">18.5</span>, <span class="number">18.8</span>, <span class="number">19.1</span>, <span class="number">19.4</span>, <span class="number">19.7</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">np.zeros(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>])</span><br><span class="line"></span><br><span class="line">np.zeros(<span class="number">10</span>,dtype=int)</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">np.zeros(shape=(<span class="number">3</span>,<span class="number">5</span>),dtype=int)</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">np.ones(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>])</span><br><span class="line"></span><br><span class="line">np.ones(shape=(<span class="number">3</span>,<span class="number">5</span>),dtype=int)</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line">np.full(<span class="number">10</span>,<span class="number">99</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>])</span><br><span class="line"></span><br><span class="line">np.full((<span class="number">3</span>,<span class="number">5</span>),<span class="number">99</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>],</span><br><span class="line">         [<span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>],</span><br><span class="line">         [<span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等差数列</span></span><br><span class="line">np.linspace(<span class="number">0</span>,<span class="number">20</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; array([ <span class="number">0.</span>        ,  <span class="number">2.22222222</span>,  <span class="number">4.44444444</span>,  <span class="number">6.66666667</span>,  <span class="number">8.88888889</span>,</span><br><span class="line">       <span class="number">11.11111111</span>, <span class="number">13.33333333</span>, <span class="number">15.55555556</span>, <span class="number">17.77777778</span>, <span class="number">20.</span>        ])</span><br></pre></td></tr></table></figure>
<p>生成随机数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">np.random.randint(<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">8</span></span><br><span class="line"></span><br><span class="line">np.random.randint(<span class="number">0</span>,<span class="number">10</span>,size = (<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">8</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">np.random.randint(<span class="number">0</span>,<span class="number">10</span>,size = (<span class="number">2</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>],</span><br><span class="line">         [<span class="number">7</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次得到的值都不同</span></span><br><span class="line">np.random.randint(<span class="number">1</span>,<span class="number">10</span>,<span class="number">5</span>) </span><br><span class="line"><span class="comment"># 而在加入seed后可在每次得到相同的值</span></span><br><span class="line">np.random.seed(<span class="number">99</span>)</span><br><span class="line">np.random.randint(<span class="number">1</span>,<span class="number">10</span>,<span class="number">5</span>) </span><br><span class="line"></span><br><span class="line"> &gt; array([<span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment"># 0-1的浮点数随机数</span></span><br><span class="line"> np.random.random()</span><br><span class="line"></span><br><span class="line"><span class="number">0.7010090560320762</span></span><br><span class="line"></span><br><span class="line">np.random.random((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0.1933131</span> , <span class="number">0.97734806</span>, <span class="number">0.57772631</span>, <span class="number">0.51376629</span>],</span><br><span class="line">         [<span class="number">0.85151867</span>, <span class="number">0.38105394</span>, <span class="number">0.27389368</span>, <span class="number">0.64060144</span>],</span><br><span class="line">         [<span class="number">0.49361568</span>, <span class="number">0.33677231</span>, <span class="number">0.61632181</span>, <span class="number">0.36050726</span>]])</span><br></pre></td></tr></table></figure>
<h2 id="ndarray的基础操作"><a href="#ndarray的基础操作" class="headerlink" title="ndarray的基础操作"></a>ndarray的基础操作</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">A = np.ones(shape=(<span class="number">3</span>,<span class="number">5</span>))</span><br><span class="line">A</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>],</span><br><span class="line">       [<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>],</span><br><span class="line">       [<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>]])</span><br><span class="line"></span><br><span class="line">A.ndim <span class="comment"># 维度</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">A.shape <span class="comment"># 维度具体数值</span></span><br><span class="line"></span><br><span class="line">&gt; (<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">A.size <span class="comment"># 元素个数</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reshape 修改数组维度</span></span><br><span class="line"></span><br><span class="line">a = np.arange(<span class="number">10</span>)</span><br><span class="line">a</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">x=a.reshape(<span class="number">2</span>,<span class="number">5</span>)</span><br><span class="line">x</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line"></span><br><span class="line">a.reshape(<span class="number">2</span>,<span class="number">-1</span>) <span class="comment"># 两行</span></span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line"></span><br><span class="line">X=a.reshape(<span class="number">-1</span>,<span class="number">2</span>)</span><br><span class="line">X</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">         [<span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">         [<span class="number">8</span>, <span class="number">9</span>]])</span><br></pre></td></tr></table></figure>

<h2 id="取值操作"><a href="#取值操作" class="headerlink" title="取值操作"></a>取值操作</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = np.arange(<span class="number">15</span>).reshape(<span class="number">3</span>,<span class="number">5</span>)</span><br><span class="line">X</span><br><span class="line"></span><br><span class="line">&gt; array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>],</span><br><span class="line">         [ <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">         [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]])</span><br><span class="line"></span><br><span class="line">X[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">X[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>])</span><br><span class="line"></span><br><span class="line">X[<span class="number">0</span>][<span class="number">1</span>] <span class="comment"># 不推荐</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">X[(<span class="number">0</span>,<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">X[<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><h3 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = np.arange(<span class="number">10</span>)</span><br><span class="line">a</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">a[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">a[<span class="number">5</span>:]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>:<span class="number">8</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">a[::<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">a[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([<span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h3 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#前两行前三列</span></span><br><span class="line">X[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">3</span>] = X[:<span class="number">2</span>,:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]])</span><br><span class="line">X[:<span class="number">2</span>,:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]])</span><br><span class="line"></span><br><span class="line">X[:<span class="number">2</span>][:<span class="number">3</span>]<span class="comment"># 前两行-&gt; 前三行</span></span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line"></span><br><span class="line">X[:<span class="number">2</span>,::<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>],</span><br><span class="line">         [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]])</span><br><span class="line"></span><br><span class="line">X[::<span class="number">-1</span>,::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">&gt; array([[<span class="number">14</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>],</span><br><span class="line">         [ <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">6</span>,  <span class="number">5</span>],</span><br><span class="line">         [ <span class="number">4</span>,  <span class="number">3</span>,  <span class="number">2</span>,  <span class="number">1</span>,  <span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">X.T</span><br><span class="line"></span><br><span class="line">&gt; array([[ <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>],</span><br><span class="line">         [ <span class="number">1</span>,  <span class="number">6</span>, <span class="number">11</span>],</span><br><span class="line">         [ <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>],</span><br><span class="line">         [ <span class="number">3</span>,  <span class="number">8</span>, <span class="number">13</span>],</span><br><span class="line">         [ <span class="number">4</span>,  <span class="number">9</span>, <span class="number">14</span>]])</span><br></pre></td></tr></table></figure>


<h3 id="矩阵的合并"><a href="#矩阵的合并" class="headerlink" title="矩阵的合并"></a>矩阵的合并</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x1 = np.array([[<span class="number">22</span>,<span class="number">168</span>],</span><br><span class="line">              [<span class="number">18</span>,<span class="number">187</span>]])</span><br><span class="line">x2 = np.array([[<span class="number">0</span>],</span><br><span class="line">               [<span class="number">1</span>]])</span><br><span class="line">x = np.concatenate([x1,x2],axis = <span class="number">1</span>)</span><br><span class="line">x</span><br><span class="line"></span><br><span class="line">array([[ <span class="number">22</span>, <span class="number">168</span>,   <span class="number">0</span>],</span><br><span class="line">       [ <span class="number">18</span>, <span class="number">187</span>,   <span class="number">1</span>]])</span><br></pre></td></tr></table></figure>
<h3 id="聚合操作"><a href="#聚合操作" class="headerlink" title="聚合操作"></a>聚合操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">x = np.arange(<span class="number">15</span>).reshape(<span class="number">3</span>,<span class="number">5</span>)</span><br><span class="line">x</span><br><span class="line"></span><br><span class="line">&gt; array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>],</span><br><span class="line">       [ <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">       [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]])</span><br><span class="line"></span><br><span class="line">np.sum(x)</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">105</span></span><br><span class="line"></span><br><span class="line">np.max(x)</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">14</span></span><br><span class="line"></span><br><span class="line">np.min(x)</span><br><span class="line"></span><br><span class="line">&gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>数据分析与数据挖掘</tag>
        <tag>Jupyter Notebook</tag>
        <tag>numpy</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapy-Redis分布式爬虫</title>
    <url>/2020/05/14/scrapy-redis/</url>
    <content><![CDATA[<p>修改scrapy-爬虫里的文件，使项目成为scrapy-redis爬虫项目<br>【redis】-【scrapy】-【爬虫】-【pyhton】</p>
<a id="more"></a>

<h1 id="Redis基础介绍"><a href="#Redis基础介绍" class="headerlink" title="Redis基础介绍"></a>Redis基础介绍</h1><h2 id="Redis-的数据库结构"><a href="#Redis-的数据库结构" class="headerlink" title="Redis 的数据库结构"></a>Redis 的数据库结构</h2><ol>
<li>Redis中有16个数据库db(0) ~ db(15)<br>开启Redis后默认使用db(0)<br>非关系型数据库，所有数据都堆积在一起</li>
<li>切换数据库：<br>select 【index】<br>例如：切换到db1 </li>
</ol>
<blockquote>
<p>select 1<br>3. 终端里<br>$ redis-cli<br>显示端口号：‘27.0.0.1:6379&gt; ’<br>select 1<br>select 0</p>
</blockquote>
<h2 id="Redis的数据类型"><a href="#Redis的数据类型" class="headerlink" title="Redis的数据类型"></a>Redis的数据类型</h2><p>后续上传文件</p>
<h2 id="pycharm-配置"><a href="#pycharm-配置" class="headerlink" title="pycharm 配置"></a>pycharm 配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line">redis_conn = redis.StrictRedis(</span><br><span class="line">    host = <span class="string">'localhost'</span>,</span><br><span class="line">    port = <span class="number">6379</span>,</span><br><span class="line">    password=<span class="string">''</span>,</span><br><span class="line">    decode_responses = <span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="运行redis命令"><a href="#运行redis命令" class="headerlink" title="运行redis命令"></a>运行redis命令</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">ret = redis_conn.execute_command(<span class="string">'keys *'</span>)</span><br><span class="line">print(ret)</span><br><span class="line">print(type(ret))</span><br><span class="line">redis_conn.execute_command(<span class="string">'set k1 v1'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line">[<span class="string">'k3'</span>, <span class="string">'k1'</span>, <span class="string">'k5'</span>, <span class="string">'k2'</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line">['k3', 'k1', 'k5', 'k2']</span><br></pre></td></tr></table></figure>

<h1 id="Scrapy-redis"><a href="#Scrapy-redis" class="headerlink" title="Scrapy-redis"></a>Scrapy-redis</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>pip install scrapy-redis</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>多个爬虫项目爬取一个网站<br>多台计算机配合爬取一个网站</p>
<p>scrapy-redis 组建实现分布式爬虫<br>不是一种框架，是一个拓展使scrapy可以完成分布式爬虫</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在scrapy项目中的settings加入下列代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动Scrapy-Redis去重过滤器，取消Scrapy的去重功能</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">"scrapy_redis.dupefilter.RFPDupeFilter"</span></span><br><span class="line"><span class="comment"># 启用Scrapy-Redis的调度器，取消Scrapy的调度器</span></span><br><span class="line">SCHEDULER = <span class="string">"scrapy_redis.scheduler.Scheduler"</span></span><br><span class="line"><span class="comment"># Scrapy-Redis断点续爬</span></span><br><span class="line">SCHEDULER_PERSIST = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 配置Redis数据库的连接</span></span><br><span class="line">REDIS_URL = <span class="string">'redis://127.0.0.1:6379'</span></span><br></pre></td></tr></table></figure>
<p>在这行代码中，需要不断访问代理IP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request.meta[<span class="string">'proxy'</span>] = <span class="string">'http://'</span> + ur.urlopen(<span class="string">'http://api.ip.data5u.com/dynamic/get.html?order=d314e5e5e19b0dfd19762f98308114ba&amp;sep=3'</span>).read().decode(<span class="string">'utf-8'</span>).strip() <span class="comment"># 设置代理</span></span><br></pre></td></tr></table></figure>

<h2 id="proxypool-py"><a href="#proxypool-py" class="headerlink" title="proxypool.py"></a>proxypool.py</h2><p>在项目文件夹（非spider）下建立proxypool.py</p>
<ol>
<li>倒入模块<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br><span class="line"><span class="keyword">import</span> time</span><br></pre></td></tr></table></figure></li>
<li>定义Proxypool类并定义两个方法<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyPool</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.redis_conn = redis.StrictRedis(</span><br><span class="line">            host=<span class="string">'localhost'</span>,</span><br><span class="line">            port = <span class="number">6379</span>,</span><br><span class="line">            decode_responses=<span class="literal">True</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_proxy</span><span class="params">(self)</span>:</span></span><br><span class="line">    	proxy_new = ur.urlopen(<span class="string">'http://api.ip.data5u.com/dynamic/get.html?order=d314e5e5e19b0dfd19762f98308114ba&amp;sep=4'</span>).read().decode(<span class="string">'utf-8'</span>).strip().split(<span class="string">' '</span>)</span><br><span class="line">    	print(proxy)</span><br><span class="line">        <span class="comment"># while True:# 不断循环获取链接</span></span><br><span class="line">        <span class="comment">#     proxy_new = ur.urlopen('http://api.ip.data5u.com/dynamic/get.html?order=d314e5e5e19b0dfd19762f98308114ba&amp;sep=4').read().decode('utf-8').strip().split(' ')# strip：去掉首位空格，split：用空格隔开</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">(self)</span>:</span></span><br><span class="line">     	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    ProxyPool().set_proxy()</span><br></pre></td></tr></table></figure>
<p>此时运行main，会获取到两个被打印的代理IP</p>
<h2 id="更换代理IP地址-得到"><a href="#更换代理IP地址-得到" class="headerlink" title="更换代理IP地址(得到)"></a>更换代理IP地址(得到)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_proxy</span><span class="params">(self)</span>:</span></span><br><span class="line">	proxy_odd = <span class="literal">None</span> <span class="comment"># 旧的代理IP地址</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	    proxy_new = ur.urlopen(<span class="string">'代理IP地址'</span>).read().decode(<span class="string">'utf-8'</span>).strip().split(<span class="string">' '</span>) <span class="comment"># 获取的新的代理IP地址</span></span><br><span class="line">	    <span class="keyword">if</span> proxy_new != proxy_odd: <span class="comment"># 如果心就的代理IP不同</span></span><br><span class="line">	    	proxy_odd = proxy_new <span class="comment"># 将新的代理IP赋值给旧的代理IP</span></span><br><span class="line">	        self.redis_conn.delete(<span class="string">'proxy'</span>) <span class="comment"># 删除链接对象里‘proxy’这个键的值</span></span><br><span class="line">	        self.redis_conn.sadd(<span class="string">'proxy'</span>,*proxy_new) <span class="comment"># 向‘proxy’这个键中添加两个代理IP地址（刚刚获取到的），这里相当于执行了两次添加</span></span><br><span class="line">	        time.sleep(<span class="number">2</span>) <span class="comment"># 睡眠</span></span><br><span class="line">	    <span class="keyword">else</span>:</span><br><span class="line">	        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="设置代理IP地址"><a href="#设置代理IP地址" class="headerlink" title="设置代理IP地址"></a>设置代理IP地址</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyPool</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">(self)</span>:</span></span><br><span class="line">	    ret = self.redis_conn.scandmember(<span class="string">'proxy'</span>,<span class="number">1</span>) <span class="comment">#得到代理IP</span></span><br><span class="line">	    print(ret) <span class="comment"># </span></span><br><span class="line">	    print(type(ret)) <span class="comment"># list对象，列表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># ProxyPool().set_proxy()</span></span><br><span class="line">    ProxyPool().get_proxy()</span><br></pre></td></tr></table></figure>
<p>在这种情况下可能出现的问题是，在set-proxy运行到’delete‘时，得到的代理IP的值为空，因此要加入一个判断，在代理IP的值为空的情况下需要进行的操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyPool</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">(self)</span>:</span></span><br><span class="line">        proxy_s = self.redis_conn.scandmember(<span class="string">'proxy'</span>,<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># print(ret)</span></span><br><span class="line">        <span class="comment"># print(type(ret))</span></span><br><span class="line">        <span class="keyword">if</span> proxy_s: <span class="comment"># 如果proxy—s的值不为空</span></span><br><span class="line">            <span class="keyword">return</span> proxy_s[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 如果为空</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>) <span class="comment"># 延时0.1s</span></span><br><span class="line">            <span class="keyword">return</span> self.get_proxy() <span class="comment"># 调用自己</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># ProxyPool().set_proxy()</span></span><br><span class="line">    ProxyPool().get_proxy()</span><br></pre></td></tr></table></figure>
<p>之后开启main方法</p>
<h2 id="修改middlewares"><a href="#修改middlewares" class="headerlink" title="修改middlewares"></a>修改middlewares</h2><p>倒入包</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> zhaobiao.proxypool <span class="keyword">import</span> ProxyPool</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZhaobiaoDownloaderMiddleware</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span> <span class="comment"># 实例化init 对象</span></span><br><span class="line">        self.proxyPool = ProxyPool() </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span></span><br><span class="line">        <span class="comment"># request.meta['proxy'] = 'http://' + ur.urlopen('http://api.ip.data5u.com/dynamic/get.html?order=d314e5e5e19b0dfd19762f98308114ba&amp;sep=3').read().decode('utf-8').strip() # 设置代理</span></span><br><span class="line">        request.meta[<span class="string">'proxy'</span>] = <span class="string">'http://'</span> + self.proxyPool.get_proxy()</span><br><span class="line">        print(request.meta[<span class="string">'proxy'</span>])</span><br></pre></td></tr></table></figure>


<h1 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h1><p>之后就可以既在pycharm中开启项目，也可以在terminal中开启项目</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>redis</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>大多数的我</title>
    <url>/2020/05/06/%E5%A4%A7%E5%A4%9A%E6%95%B0%E7%9A%84%E6%88%91/</url>
    <content><![CDATA[<p>少数的我<br>梦见了故乡</p>
<a id="more"></a>
<p>从未回去那里的魂魄<br>抢夺去了风中<br>应见泪水相拥的画面<br>战乱连年<br>仅有的雨也成了雪<br>融入这暴戾的暖炉<br>痛不知思绪的去向<br>只能肆意地游荡在躯体<br>千万之一相见的几率<br>释怀于死前<br>无言的喧寂<br>大多数的我<br>梦不见故乡<br>身处于不知何方 无可奈何<br>指引的信号刻画于手臂<br>感官隐于黑暗<br>轻道  恭喜</p>
]]></content>
      <categories>
        <category>思考与遐想</category>
      </categories>
      <tags>
        <tag>采集忘却</tag>
      </tags>
  </entry>
  <entry>
    <title>如果我想你</title>
    <url>/2020/05/08/%E5%A6%82%E6%9E%9C%E6%88%91%E6%83%B3%E4%BD%A0/</url>
    <content><![CDATA[<p>愿你能从他身上听到你想听的话<br>单调却挂念的话<br>有没有一些<br>来自我这个人渣</p>
<a id="more"></a>
<p>记忆的沙 霜冻的画<br>故乡的花已经发芽<br>牵着希望的手悄然滑下<br>我还是怀念我残破的家<br>音乐盒的主人公默念牵挂<br>没有你的口信<br>我不敢安家<br>你还留着我寄存的味道吗<br>书写下的话 让天空散漫着花<br>那景象是我从未见过的<br>我想问你可知爱字如何落下<br>却无法否认那是我从未见过的回答</p>
]]></content>
      <categories>
        <category>思考与遐想</category>
      </categories>
      <tags>
        <tag>采集忘却</tag>
      </tags>
  </entry>
  <entry>
    <title>爬虫项目1</title>
    <url>/2020/05/13/%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE1/</url>
    <content><![CDATA[<p>通过在老师带领下操作了爬虫项目爬取csdn的热门博客，希望自己可以试着去爬取bilibili上某一up主的视频题目</p>
<a id="more"></a>

<h1 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h1><h2 id="获取网页内容"><a href="#获取网页内容" class="headerlink" title="获取网页内容"></a>获取网页内容</h2><p>首先，由于是直接找某一up的视频，所以网站解析页可以为他的主页</p>
<blockquote>
<p>https: //space.bilibili.com/</p>
</blockquote>
<p>在主页中，选择选项中的“视频”，可以获得一个新的网址</p>
<blockquote>
<p>https: //space.bilibili.com/99157282/video</p>
</blockquote>
<p>为了寻找到不同页数时所使用的不同网址，因此点击第二、三页得到另一个网址</p>
<blockquote>
<p>https: //space.bilibili.com/99157282/video?tid=0&amp;page=2&amp;keyword=&amp;order=pubdate<br>https: //space.bilibili.com/99157282/video?tid=0&amp;page=3&amp;keyword=&amp;order=pubdate<br>通过对比可以发现在不同页面只有【page=2】更改，因此可以了解到不同页面的区别只是需要更改page的数字即可</p>
</blockquote>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>爬虫</tag>
        <tag>个人项目</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapy爬虫</title>
    <url>/2020/05/13/%E7%88%AC%E8%99%AB/</url>
    <content><![CDATA[<p>python-scrapy学习中所做的爬取某一招标网站的内容<br>【scrapy】-【爬虫】-【pyhton】</p>
<a id="more"></a>

<h1 id="模拟请求头与代理IP"><a href="#模拟请求头与代理IP" class="headerlink" title="模拟请求头与代理IP"></a>模拟请求头与代理IP</h1><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><ol>
<li>找到目标文件夹</li>
<li>创建项目  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ scrapy startproject &#39;ProjectName&#39;</span><br><span class="line">$ cd &#39;ProjectName&#39;</span><br><span class="line">$ scrapy genspider &#39;Name&#39; &quot;网站域名&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="配置Setting"><a href="#配置Setting" class="headerlink" title="配置Setting"></a>配置Setting</h2><ol>
<li><p>关闭Robot协议</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br></pre></td></tr></table></figure></li>
<li><p>开启Download_Delay</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DOWNLOAD_DELAY = <span class="number">3</span></span><br></pre></td></tr></table></figure></li>
<li><p>设置默认请求头</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DEFAULT_REQUEST_HEADERS = &#123;</span><br><span class="line">  <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span><br><span class="line">  <span class="string">'Accept-Language'</span>: <span class="string">'en'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启下载中间件与管道文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">   <span class="string">'zhaobiao.middlewares.ZhaobiaoDownloaderMiddleware'</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">'zhaobiao.pipelines.ZhaobiaoPipeline'</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>设置请求头 Cookie和User-Agent</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DEFAULT_REQUEST_HEADERS = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Cookie'</span>:<span class="string">'登陆后的cookie'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Spiders-项目文件"><a href="#Spiders-项目文件" class="headerlink" title="Spiders/项目文件"></a>Spiders/项目文件</h2><h3 id="设置存储的数据格式"><a href="#设置存储的数据格式" class="headerlink" title="设置存储的数据格式"></a>设置存储的数据格式</h3><p>即爬虫项目里需要爬取的内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sql_data = dict(</span><br><span class="line">      projectcode=<span class="string">''</span>,  <span class="comment"># 项目编号</span></span><br><span class="line">      web=<span class="string">''</span>,  <span class="comment"># 信息来源网站</span></span><br><span class="line">      keyword=<span class="string">''</span>,  <span class="comment"># 关键字</span></span><br><span class="line">      detail_url=<span class="string">''</span>,  <span class="comment"># 招标详细页网址</span></span><br><span class="line">      title=<span class="string">''</span>,  <span class="comment"># 第三方网站发布标题</span></span><br><span class="line">      toptype=<span class="string">''</span>,  <span class="comment"># 信息类型</span></span><br><span class="line">      province=<span class="string">''</span>,  <span class="comment"># 归属省份</span></span><br><span class="line">      product=<span class="string">''</span>,  <span class="comment"># 产品范畴</span></span><br><span class="line">      industry=<span class="string">''</span>,  <span class="comment"># 归属行业</span></span><br><span class="line">      tendering_manner=<span class="string">''</span>,  <span class="comment"># 招标方式</span></span><br><span class="line">      publicity_date=<span class="string">''</span>,  <span class="comment"># 招标公示日期</span></span><br><span class="line">      expiry_date=<span class="string">''</span>,  <span class="comment"># 招标截止时间</span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure>

<h3 id="设置Form表单的数据格式"><a href="#设置Form表单的数据格式" class="headerlink" title="设置Form表单的数据格式"></a>设置Form表单的数据格式</h3><p>即从网站可以获取的数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">form_data = dict(</span><br><span class="line">       infoClassCodes=<span class="string">''</span>,</span><br><span class="line">       rangeType=<span class="string">''</span>,</span><br><span class="line">       projectType=<span class="string">'bid'</span>,</span><br><span class="line">       fundSourceCodes=<span class="string">''</span>,</span><br><span class="line">       dateType=<span class="string">''</span>,</span><br><span class="line">       startDateCode=<span class="string">''</span>,</span><br><span class="line">       endDateCode=<span class="string">''</span>,</span><br><span class="line">       normIndustry=<span class="string">''</span>,</span><br><span class="line">       normIndustryName=<span class="string">''</span>,</span><br><span class="line">       zone=<span class="string">''</span>,</span><br><span class="line">       zoneName=<span class="string">''</span>,</span><br><span class="line">       zoneText=<span class="string">''</span>,</span><br><span class="line">       key=<span class="string">''</span>,  <span class="comment"># 搜索的关键字</span></span><br><span class="line">       pubDateType=<span class="string">''</span>,</span><br><span class="line">       pubDateBegin=<span class="string">''</span>,</span><br><span class="line">       pubDateEnd=<span class="string">''</span>,</span><br><span class="line">       sortMethod=<span class="string">'timeDesc'</span>,</span><br><span class="line">       orgName=<span class="string">''</span>,</span><br><span class="line">       currentPage=<span class="string">''</span>,  <span class="comment"># 当前页码</span></span><br><span class="line">   )</span><br></pre></td></tr></table></figure>
<h3 id="定义start-requests-self"><a href="#定义start-requests-self" class="headerlink" title="定义start_requests(self)"></a>定义start_requests(self)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">    form_data = self.form_data</span><br><span class="line">    form_data[<span class="string">'key'</span>] = <span class="string">'路由器'</span></span><br><span class="line">    form_data[<span class="string">'currentPage'</span>] = <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> scrapy.FormRequest( <span class="comment"># 对FormRequest的封装，可以提交表单数据</span></span><br><span class="line">        url = <span class="string">'http://ss.ebnew.com/tradingSearch/index.htm'</span>,</span><br><span class="line">        formdata= form_data,<span class="comment"># 传递字典对象</span></span><br><span class="line">        callback=self.parse_page1,<span class="comment"># 定义回调函数</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page1</span><span class="params">(self,response)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'2.html'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(response.body) <span class="comment"># 写入到本地</span></span><br></pre></td></tr></table></figure>

<h3 id="创建start文件"><a href="#创建start文件" class="headerlink" title="创建start文件"></a>创建start文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"></span><br><span class="line">cmdline.execute(<span class="string">'scrapy crawl bilian'</span>.split())</span><br></pre></td></tr></table></figure>

<h2 id="配置代理ip"><a href="#配置代理ip" class="headerlink" title="配置代理ip"></a>配置代理ip</h2><p>找到middlewares里的class ZhaobiaoDownloaderMiddleware 里的<br>process_request</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 需要倒入包</span></span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur <span class="comment"># 使用ur.urlopen</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span></span><br><span class="line">        request.meta[<span class="string">'proxy'</span>] = <span class="string">'http://'</span> + ur.urlopen(<span class="string">'代理IP地址'</span>).read().decode(<span class="string">'utf-8'</span>).strip() <span class="comment"># 设置代理</span></span><br></pre></td></tr></table></figure>
<p>.strip（）去掉首位换行符</p>
<h1 id="页面中的数据过滤提取"><a href="#页面中的数据过滤提取" class="headerlink" title="页面中的数据过滤提取"></a>页面中的数据过滤提取</h1><h2 id="定义parse-page1"><a href="#定义parse-page1" class="headerlink" title="定义parse_page1"></a>定义parse_page1</h2><p>从网页中寻找有需要的信息，并用xpath标记出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page1</span><span class="params">(self,response)</span>:</span></span><br><span class="line">    content_list_x_s = response.xpath(<span class="string">'//div[@class="ebnew-content-list"]/div'</span>)</span><br><span class="line">    <span class="keyword">for</span> content_list_x <span class="keyword">in</span> content_list_x_s:</span><br><span class="line">        toptype = content_list_x.xpath(<span class="string">'./div[1]/i[1]/text()'</span>).extract_first()</span><br><span class="line">        title = content_list_x.xpath(<span class="string">'./div[1]/a[1]/text()'</span>).extract_first()</span><br><span class="line">        publicity_date =content_list_x.xpath(<span class="string">'./div[1]/i[2]/text()'</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> publicity_date:</span><br><span class="line">            publicity_date = re.sub(<span class="string">'[^0-9\-]'</span>,<span class="string">''</span>,publicity_date) <span class="comment"># 将发布日期里的文字'发布日期'替换成空字符串的格式</span></span><br><span class="line"></span><br><span class="line">        tendering_manner = content_list_x.xpath(<span class="string">'./div[2]/div[1]/p[1]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        product = content_list_x.xpath(<span class="string">'./div[2]/div[1]/p[2]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        expiry_date = content_list_x.xpath(<span class="string">'./div[2]/div[2]/p[1]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        province = content_list_x.xpath(<span class="string">'./div[2]/div[2]/p[2]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        <span class="comment"># print(toptype,title,publicity_date,tendering_manner,product,expiry_date,province)</span></span><br></pre></td></tr></table></figure>

<h2 id="定义parse-page2"><a href="#定义parse-page2" class="headerlink" title="定义parse_page2"></a>定义parse_page2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> scrapy.Request(</span><br><span class="line">        url = <span class="string">'http://www.ebnew.com/businessShow/645672039.html'</span>,</span><br><span class="line">        callback = self.parse_page(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page2</span><span class="params">(self,response)</span>:</span></span><br><span class="line">    li_x_s = response.xpath(<span class="string">'//ul[@class="ebnew-project-information pd-t25 pd-b25 pd-l20 clearfix ebnew-border bg-f9 mg-t20 color-444 font-12"]/li'</span>)</span><br><span class="line">    projectcode = li_x_s[<span class="number">0</span>].xpath(<span class="string">'./span[2]/text()'</span>).extract_first()</span><br><span class="line">    industry = li_x_s[<span class="number">7</span>].xpath(<span class="string">'./span[2]/text()'</span>).extract_first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> projectcode: <span class="comment"># 在没有找到项目编号的情况下使用正则表达式来寻找</span></span><br><span class="line">        projectcode_find = re.findall(<span class="string">'项目编号[：:]&#123;0,1&#125;\s&#123;0,2&#125;([a-zA-Z0-9\-]&#123;10,80&#125;)'</span>,response.body.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">        projectcode = projectcode_find[<span class="number">0</span>] <span class="keyword">if</span> projectcode_find <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">    <span class="comment"># print(industry,projectcode)</span></span><br></pre></td></tr></table></figure>


<h1 id="异常请求的处理机制"><a href="#异常请求的处理机制" class="headerlink" title="异常请求的处理机制"></a>异常请求的处理机制</h1><p>在setting中加入</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LOG_FILE= <span class="string">'zhaobiao.log'</span> <span class="comment"># 将错误写入到这个错误文件中</span></span><br><span class="line">LOG_LEVEL = <span class="string">'ERROR'</span> <span class="comment"># 定义错误写入的错误级别</span></span><br></pre></td></tr></table></figure>

<h1 id="请求链的健壮性优化"><a href="#请求链的健壮性优化" class="headerlink" title="请求链的健壮性优化"></a>请求链的健壮性优化</h1><h2 id="首先定义关键字"><a href="#首先定义关键字" class="headerlink" title="首先定义关键字"></a>首先定义关键字</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">keyword_s =[</span><br><span class="line">    <span class="string">'路由器'</span>,<span class="string">'变压器'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="注释异常请求的处理机制"><a href="#注释异常请求的处理机制" class="headerlink" title="注释异常请求的处理机制"></a>注释异常请求的处理机制</h2><h2 id="一些细小的修改"><a href="#一些细小的修改" class="headerlink" title="一些细小的修改"></a>一些细小的修改</h2><ol>
<li>在allowed_domaine中加入参数，因为start_request中有’<a href="http://ss.ebnew.com/tradingSearch/index.htm&#39;" target="_blank" rel="noopener">http://ss.ebnew.com/tradingSearch/index.htm&#39;</a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">allowed_domains = [<span class="string">'ebnew'</span>,<span class="string">'ss.ebnew.com'</span>]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="异步IO实现数据持久化储存"><a href="#异步IO实现数据持久化储存" class="headerlink" title="异步IO实现数据持久化储存"></a>异步IO实现数据持久化储存</h1><h2 id="PyMysql"><a href="#PyMysql" class="headerlink" title="PyMysql"></a>PyMysql</h2><p>连接本地数据库‘pipelines.py’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql <span class="comment"># 倒入包</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.mysql_conn = pymysql.connections(</span><br><span class="line">            host = <span class="string">'localhost'</span>,</span><br><span class="line">            post=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">'root'</span>,</span><br><span class="line">            password = <span class="string">'126511'</span>,</span><br><span class="line">            database=<span class="string">'zhaobiao'</span>,</span><br><span class="line">            charset=<span class="string">'utf8'</span>,</span><br><span class="line"></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> zhaobiao <span class="keyword">charset</span> utf8 <span class="comment"># 创建数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_zhaobiao( <span class="comment"># 创建表格</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    projectcode <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    web <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    keyword <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    detail_url <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    title <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    toptype <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    province <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    product <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    industry <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    tendering_manner <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    publicity_date <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    expiry_date <span class="built_in">varchar</span>(<span class="number">100</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建光标对象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">      <span class="comment"># 创建光标对象</span></span><br><span class="line">      cs = self.mysql_conn.cursur()</span><br><span class="line">      <span class="comment"># sql_str = 'insert into t_zhaobiao (字段,字段) value ("值","值")'</span></span><br><span class="line">      sql_column = <span class="string">','</span>.join([key <span class="keyword">for</span> key <span class="keyword">in</span> item.keys()])</span><br><span class="line">      sql_value = <span class="string">','</span>.join([<span class="string">'"%s"'</span>% item[key] <span class="keyword">for</span> key <span class="keyword">in</span> item.keys()])</span><br><span class="line">      sql_str = <span class="string">'insert into t_zhaobiao (%s) value (%s);'</span> %(sql_column,sql_value)</span><br><span class="line">      cs.execute(sql_str)</span><br><span class="line"></span><br><span class="line">      self.mysql_conn.commit()</span><br><span class="line">      <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<p>代码主体修改及补充</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span> <span class="comment"># 可以跳过allow domaine</span></span><br><span class="line">       <span class="keyword">for</span> keyword <span class="keyword">in</span> self.keyword_s:</span><br><span class="line">           form_data = deepcopy(self.form_data)</span><br><span class="line">           form_data[<span class="string">'key'</span>] = keyword</span><br><span class="line">           form_data[<span class="string">'currentPage'</span>] = <span class="string">'1'</span></span><br><span class="line">           request = scrapy.FormRequest(</span><br><span class="line">               url=<span class="string">'http://ss.ebnew.com/tradingSearch/index.htm'</span>,</span><br><span class="line">               formdata=form_data,</span><br><span class="line">               callback=self.parse_start</span><br><span class="line">           )</span><br><span class="line">           request.meta[<span class="string">'form_data'</span>] = form_data <span class="comment"># 把这个对象保存在request对象的meta里</span></span><br><span class="line">           <span class="keyword">yield</span> request</span><br></pre></td></tr></table></figure>


<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="bilian-py"><a href="#bilian-py" class="headerlink" title="bilian.py"></a>bilian.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> re <span class="comment">#</span></span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy <span class="comment"># 深度复制</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BilianSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'bilian'</span></span><br><span class="line">    allowed_domains = [<span class="string">'ebnew'</span>,<span class="string">'ss.ebnew.com'</span>]</span><br><span class="line"></span><br><span class="line">    keyword_s =[</span><br><span class="line">        <span class="string">'路由器'</span>,<span class="string">'变压器'</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># start_urls = ['http://ebnew/']</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># def parse(self, response):</span></span><br><span class="line">    <span class="comment">#     pass</span></span><br><span class="line">    <span class="comment"># 存储的数据格式</span></span><br><span class="line">    sql_data = dict(</span><br><span class="line">        projectcode=<span class="string">''</span>,  <span class="comment"># 项目编号</span></span><br><span class="line">        web=<span class="string">''</span>,  <span class="comment"># 信息来源网站</span></span><br><span class="line">        keyword=<span class="string">''</span>,  <span class="comment"># 关键字</span></span><br><span class="line">        detail_url=<span class="string">''</span>,  <span class="comment"># 招标详细页网址</span></span><br><span class="line">        title=<span class="string">''</span>,  <span class="comment"># 第三方网站发布标题</span></span><br><span class="line">        toptype=<span class="string">''</span>,  <span class="comment"># 信息类型</span></span><br><span class="line">        province=<span class="string">''</span>,  <span class="comment"># 归属省份</span></span><br><span class="line">        product=<span class="string">''</span>,  <span class="comment"># 产品范畴</span></span><br><span class="line">        industry=<span class="string">''</span>,  <span class="comment"># 归属行业</span></span><br><span class="line">        tendering_manner=<span class="string">''</span>,  <span class="comment"># 招标方式</span></span><br><span class="line">        publicity_date=<span class="string">''</span>,  <span class="comment"># 招标公示日期</span></span><br><span class="line">        expiry_date=<span class="string">''</span>,  <span class="comment"># 招标截止时间</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Form表单的数据格式</span></span><br><span class="line">    form_data = dict(</span><br><span class="line">        infoClassCodes=<span class="string">''</span>,</span><br><span class="line">        rangeType=<span class="string">''</span>,</span><br><span class="line">        projectType=<span class="string">'bid'</span>,</span><br><span class="line">        fundSourceCodes=<span class="string">''</span>,</span><br><span class="line">        dateType=<span class="string">''</span>,</span><br><span class="line">        startDateCode=<span class="string">''</span>,</span><br><span class="line">        endDateCode=<span class="string">''</span>,</span><br><span class="line">        normIndustry=<span class="string">''</span>,</span><br><span class="line">        normIndustryName=<span class="string">''</span>,</span><br><span class="line">        zone=<span class="string">''</span>,</span><br><span class="line">        zoneName=<span class="string">''</span>,</span><br><span class="line">        zoneText=<span class="string">''</span>,</span><br><span class="line">        key=<span class="string">''</span>,  <span class="comment"># 搜索的关键字</span></span><br><span class="line">        pubDateType=<span class="string">''</span>,</span><br><span class="line">        pubDateBegin=<span class="string">''</span>,</span><br><span class="line">        pubDateEnd=<span class="string">''</span>,</span><br><span class="line">        sortMethod=<span class="string">'timeDesc'</span>,</span><br><span class="line">        orgName=<span class="string">''</span>,</span><br><span class="line">        currentPage=<span class="string">''</span>,  <span class="comment"># 当前页码</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span> <span class="comment"># 可以跳过allow domaine</span></span><br><span class="line">        <span class="keyword">for</span> keyword <span class="keyword">in</span> self.keyword_s:</span><br><span class="line">            form_data = deepcopy(self.form_data)</span><br><span class="line">            form_data[<span class="string">'key'</span>] = keyword</span><br><span class="line">            form_data[<span class="string">'currentPage'</span>] = <span class="string">'1'</span></span><br><span class="line">            request = scrapy.FormRequest(</span><br><span class="line">                url=<span class="string">'http://ss.ebnew.com/tradingSearch/index.htm'</span>,</span><br><span class="line">                formdata=form_data,</span><br><span class="line">                callback=self.parse_start</span><br><span class="line">            )</span><br><span class="line">            request.meta[<span class="string">'form_data'</span>] = form_data <span class="comment"># 把这个对象保存在request对象的meta里</span></span><br><span class="line">            <span class="keyword">yield</span> request</span><br><span class="line"></span><br><span class="line">        <span class="comment"># yield scrapy.Request(</span></span><br><span class="line">        <span class="comment">#     url = 'http://www.ebnew.com/businessShow/645672039.html',</span></span><br><span class="line">        <span class="comment">#     callback = self.parse_page(2)</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># form_data = self.form_data</span></span><br><span class="line">        <span class="comment"># form_data['key'] = '路由器'</span></span><br><span class="line">        <span class="comment"># form_data['currentPage'] = '2'</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># yield scrapy.FormRequest( # 对FormRequest的封装，可以提交表单数据</span></span><br><span class="line">        <span class="comment">#     url = 'http://ss.ebnew.com/tradingSearch/index.htm',</span></span><br><span class="line">        <span class="comment">#     formdata= form_data,# 传递字典对象</span></span><br><span class="line">        <span class="comment">#     callback=self.parse_page1,# 定义回调函数</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_start</span><span class="params">(self,response)</span>:</span></span><br><span class="line">        a_text_s = response.xpath(<span class="string">'//form[@id="pagerSubmitForm"]/a/text()'</span>).extract()</span><br><span class="line">        page_max = max(</span><br><span class="line">            [int(a_text) <span class="keyword">for</span> a_text <span class="keyword">in</span> a_text_s <span class="keyword">if</span> re.match(<span class="string">'\d+'</span>,a_text)] <span class="comment"># 都是数字的列表取最大值</span></span><br><span class="line">        )</span><br><span class="line">        page_max = <span class="number">2</span></span><br><span class="line">        self.parse_page1(response) <span class="comment"># parse_start 访问的就是第一页，所以要加这个步骤，在进行其他页码的遍历</span></span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">2</span>,page_max+<span class="number">1</span>):</span><br><span class="line">            form_data = deepcopy(response.meta[<span class="string">'form_data'</span>])</span><br><span class="line">            form_data[<span class="string">'currentPage'</span>] = str(page)</span><br><span class="line">            request = scrapy.FormRequest(</span><br><span class="line">                url = <span class="string">'http://ss.ebnew.com/tradingSearch/index.htm'</span>,</span><br><span class="line">                formdata=form_data,</span><br><span class="line">                callback=self.parse_page1</span><br><span class="line">            )</span><br><span class="line">            request.meta[<span class="string">'form_data'</span>] = form_data</span><br><span class="line">            <span class="keyword">yield</span> request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_page1</span><span class="params">(self,response)</span>:</span></span><br><span class="line">        form_data = response.meta[<span class="string">'form_data'</span>]</span><br><span class="line">        keyword = form_data.get(<span class="string">'key'</span>)</span><br><span class="line">        content_list_x_s = response.xpath(<span class="string">'//div[@class="ebnew-content-list"]/div'</span>)</span><br><span class="line">        <span class="keyword">for</span> content_list_x <span class="keyword">in</span> content_list_x_s:</span><br><span class="line">            sql_data = deepcopy(self.sql_data)</span><br><span class="line">            <span class="comment"># 这里需要把下面的数据保存到sql_data里</span></span><br><span class="line">            sql_data[<span class="string">'toptype'</span>] = content_list_x.xpath(<span class="string">'./div[1]/i[1]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'title'</span>] = content_list_x.xpath(<span class="string">'./div[1]/a[1]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'publicity_date'</span>] =content_list_x.xpath(<span class="string">'./div[1]/i[2]/text()'</span>).extract_first()</span><br><span class="line">            <span class="keyword">if</span> sql_data[<span class="string">'publicity_date'</span>]:</span><br><span class="line">                sql_data[<span class="string">'publicity_date'</span>] = re.sub(<span class="string">'[^0-9\-]'</span>,<span class="string">''</span>,sql_data[<span class="string">'publicity_date'</span>]) <span class="comment"># 将发布日期里的文字'发布日期'替换成空字符串的格式</span></span><br><span class="line"></span><br><span class="line">            sql_data[<span class="string">'tendering_manner'</span>] = content_list_x.xpath(<span class="string">'./div[2]/div[1]/p[1]/span[2]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'product'</span>] = content_list_x.xpath(<span class="string">'./div[2]/div[1]/p[2]/span[2]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'expiry_date'</span>] = content_list_x.xpath(<span class="string">'./div[2]/div[2]/p[1]/span[2]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'province'</span>] = content_list_x.xpath(<span class="string">'./div[2]/div[2]/p[2]/span[2]/text()'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'detail_url'</span>] = content_list_x.xpath(<span class="string">'./div[1]/a/@href'</span>).extract_first()</span><br><span class="line">            sql_data[<span class="string">'keyword'</span>] = keyword</span><br><span class="line">            sql_data[<span class="string">'web'</span>] = <span class="string">'必联网'</span></span><br><span class="line">            request = scrapy.Request(</span><br><span class="line">                url = sql_data[<span class="string">'detail_url'</span>],</span><br><span class="line">                callback=self.parse_page2</span><br><span class="line">            )</span><br><span class="line">            request.meta[<span class="string">'sql_data'</span>] = sql_data</span><br><span class="line">            <span class="keyword">yield</span> request</span><br><span class="line">            <span class="comment"># print(toptype,title,publicity_date,tendering_manner,product,expiry_date,province)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_page2</span><span class="params">(self,response)</span>:</span></span><br><span class="line">        sql_data = response.meta[<span class="string">'sql_data'</span>]</span><br><span class="line">        sql_data[<span class="string">'projectcode'</span>] = response.xpath(</span><br><span class="line">            <span class="string">'/ul[contains(@class,"ebnew-project-information")]/li[1]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        sql_data[<span class="string">'industry'</span>] = response.xpath(</span><br><span class="line">            <span class="string">'/ul[contains(@class,"ebnew-project-information")]/li[8]/span[2]/text()'</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> response.meta[<span class="string">'projectcode'</span>]:</span><br><span class="line">            projectcode_find = re.findall(<span class="string">'项目编号[：:]&#123;0,1&#125;\s&#123;0,2&#125;([a-zA-Z0-9\-]&#123;10,80&#125;)'</span>,response.body.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">            response.meta[<span class="string">'projectcode '</span>]= projectcode_find[<span class="number">0</span>] <span class="keyword">if</span> projectcode_find <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">        <span class="comment"># print(industry,projectcode)</span></span><br><span class="line">        <span class="keyword">yield</span> sql_data <span class="comment"># 把sql_data转交给管道文件</span></span><br></pre></td></tr></table></figure>
<h2 id="pipelines-py"><a href="#pipelines-py" class="headerlink" title="pipelines.py"></a>pipelines.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZhaobiaoPipeline</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.mysql_conn = pymysql.connections(</span><br><span class="line">            host = <span class="string">'localhost'</span>,</span><br><span class="line">            post=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">'root'</span>,</span><br><span class="line">            password = <span class="string">'126511'</span>,</span><br><span class="line">            database=<span class="string">'zhaobiao'</span>,</span><br><span class="line">            charset=<span class="string">'utf8'</span>,</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        <span class="comment"># 创建光标对象</span></span><br><span class="line">        cs = self.mysql_conn.cursur()</span><br><span class="line">        <span class="comment"># sql_str = 'insert into t_zhaobiao (字段,字段) value ("值","值")'</span></span><br><span class="line">        sql_column = <span class="string">','</span>.join([key <span class="keyword">for</span> key <span class="keyword">in</span> item.keys()])</span><br><span class="line">        sql_value = <span class="string">','</span>.join([<span class="string">'"%s"'</span>% item[key] <span class="keyword">for</span> key <span class="keyword">in</span> item.keys()])</span><br><span class="line">        sql_str = <span class="string">'insert into t_zhaobiao (%s) value (%s);'</span> %(sql_column,sql_value)</span><br><span class="line">        cs.execute(sql_str)</span><br><span class="line"></span><br><span class="line">        self.mysql_conn.commit()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>爬虫</tag>
        <tag>个人项目</tag>
      </tags>
  </entry>
  <entry>
    <title>matplotlib</title>
    <url>/2020/05/19/matplotlib/</url>
    <content><![CDATA[<h1 id="Matplotlib-安装"><a href="#Matplotlib-安装" class="headerlink" title="Matplotlib 安装"></a>Matplotlib 安装</h1><h1 id="Matplotlib-绘制散点图"><a href="#Matplotlib-绘制散点图" class="headerlink" title="Matplotlib 绘制散点图"></a>Matplotlib 绘制散点图</h1><h1 id="Matplotlib-绘制折线图"><a href="#Matplotlib-绘制折线图" class="headerlink" title="Matplotlib 绘制折线图"></a>Matplotlib 绘制折线图</h1><h1 id="Matplotlib-绘制柱状图和饼状图"><a href="#Matplotlib-绘制柱状图和饼状图" class="headerlink" title="Matplotlib 绘制柱状图和饼状图"></a>Matplotlib 绘制柱状图和饼状图</h1><h1 id="Matplotlib-绘制直方图和箱线图"><a href="#Matplotlib-绘制直方图和箱线图" class="headerlink" title="Matplotlib 绘制直方图和箱线图"></a>Matplotlib 绘制直方图和箱线图</h1><h1 id="Matplotlib-绘制子图"><a href="#Matplotlib-绘制子图" class="headerlink" title="Matplotlib 绘制子图"></a>Matplotlib 绘制子图</h1><h1 id="pandas中绘制图表"><a href="#pandas中绘制图表" class="headerlink" title="pandas中绘制图表"></a>pandas中绘制图表</h1>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>数据分析与数据挖掘</tag>
        <tag>Jupyter Notebook</tag>
        <tag>numpy</tag>
        <tag>Pandas</tag>
      </tags>
  </entry>
</search>
